# 3天稳妥上线执行清单（腾讯云主线）

## 目标
- 腾讯云后端作为唯一主线完成全链路验收
- 完成 1 笔真实支付闭环验证
- 完成高危安全收口与基础压测
- 输出 Go / No-Go 结论

## 基准信息（先填写）
- 前端地址（Vercel）:
- 后端地址（Tencent）:
- 支付回调地址:
- 发布分支:
- 回滚版本:

---

## Day 1 - 功能真相日

### A. 环境冻结
- [ ] 冻结发布分支，停止新功能合并
- [ ] 前端 API 基址仅指向腾讯云后端
- [ ] 记录当日版本号（前后端 commit）

### B. 全链路回归
- [ ] M1: 上传 -> 生成 -> 结果 -> 下载（正常）
- [ ] M1: 缺参/异常网络（异常）
- [ ] M2: 上传 -> 模板 -> 生成 -> 下载（正常）
- [ ] M2: 缺参/异常网络（异常）
- [ ] M3: 双人素材 -> 生成 -> 下载（正常）
- [ ] M3: 缺参/异常网络（异常）
- [ ] 文案 -> 语音 -> 视频合成（正常）
- [ ] 文案 -> 语音 -> 视频合成（异常）
- [ ] 支付: 下单 -> 支付页 -> 返回结果页（正常）

### C. 缺陷池
- [ ] 产出缺陷清单（复现步骤 + 日志 + 级别）
- [ ] P0 当天可修项全部收口

---

## Day 2 - 安全与压测日

### A. 安全收口核验
- [ ] 生产环境手动补单禁用（403）
- [ ] 支付回调金额篡改返回 fail
- [ ] CORS 非白名单 Origin 被拦截
- [ ] 音频切片非法时间参数被拦截
- [ ] 生产环境错误响应不暴露堆栈

### B. 压测（轻接口）
- [ ] `npm run loadtest:health`
- [ ] `npm run loadtest:order`
- [ ] `npm run loadtest:order-status`
- [ ] 记录 P95、错误率、RPS

阈值（轻接口）:
- [ ] P95 < 1.5s
- [ ] 错误率 < 1%

### C. 压测（重接口，建议小并发）
- [ ] `/api/audio/split-traditional` 并发 2~3，执行 10~20 任务
- [ ] `/api/video/compose` 并发 2~3，执行 10~20 任务
- [ ] 记录失败率与超时情况

阈值（重接口）:
- [ ] 错误率 < 3%
- [ ] 无进程崩溃 / 无持续内存异常增长

### D. 真实支付闭环
- [ ] 完成 1 笔真实小额支付
- [ ] 核验回调日志、订单状态、积分到账一致

---

## Day 3 - 预发布与闸门日

### A. 预发布演练
- [ ] 从首页开始走完整用户路径一次
- [ ] 核对下载链接、静态资源、回调地址正确

### B. 边界场景回归
- [ ] 重复支付回调
- [ ] 订单过期
- [ ] 大文件上传失败
- [ ] 后端重启后订单状态一致性

### C. Go / No-Go 评审
- [ ] P0 = 0
- [ ] 真实支付闭环成功
- [ ] 压测指标达标
- [ ] 核心链路回归通过
- [ ] 回滚方案已演练

结论:
- [ ] Go
- [ ] No-Go

---

## 上线后24小时监控
- [ ] 每 2 小时检查: 下单量、成功率、回调成功率
- [ ] 每 2 小时检查: 接口 5xx、超时比例
- [ ] 告警阈值: 支付回调连续失败 > 3 次
- [ ] 告警阈值: 视频处理失败率显著上升

---

## 回滚触发条件
- [ ] 支付链路异常
- [ ] P0 安全问题复现
- [ ] 核心生成链路连续失败率 > 10%

