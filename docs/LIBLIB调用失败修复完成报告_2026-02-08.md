# LIBLIBè°ƒç”¨å¤±è´¥ä¿®å¤å®ŒæˆæŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2026-02-08
**é—®é¢˜**: VideoPage â†’ M1æ¨¡æ¿é€‰æ‹© â†’ LabPage â†’ LIBLIBè°ƒç”¨å¤±è´¥

---

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

### 1. âš ï¸ ç¯å¢ƒå˜é‡ç¼ºå¤±ï¼ˆä¸»è¦åŸå› ï¼‰
- **.env æ–‡ä»¶ç¼ºå°‘ LIBLIB_ACCESS_KEY å’Œ LIBLIB_SECRET_KEY**
- åç«¯ api-proxy-endpoints.js ä½¿ç”¨äº†ç¡¬ç¼–ç çš„é»˜è®¤å¯†é’¥
- è¿™äº›é»˜è®¤å¯†é’¥å¯èƒ½å·²å¤±æ•ˆæˆ–ä¸æ˜¯ç”¨æˆ·çš„çœŸå®å¯†é’¥

### 2. âš ï¸ æ•°æ®æµè½¬ä¸å®Œæ•´ï¼ˆæ¬¡è¦é—®é¢˜ï¼‰
è™½ç„¶ä¸ä¼šå¯¼è‡´LIBLIBè°ƒç”¨å¤±è´¥ï¼Œä½†æ•°æ®æµè½¬æœ‰æ–­è£‚ï¼š

```
VideoPage (ä¼ é€’ NavigationState)
    â†“
ImageGeneratorSelector (M1/M2é€‰æ‹©)
    â†“
TemplateSelectionPage (âŒ æœªæ¥æ”¶NavigationState)
    â†“ (è¦†ç›–äº†state!)
LabPage (âŒ æœªæ¥æ”¶NavigationState)
```

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### ä¿®å¤1: æ·»åŠ LIBLIBç¯å¢ƒå˜é‡

**æ–‡ä»¶**: `.env`
**ä¿®æ”¹å†…å®¹**:
```env
# LiblibAIï¼ˆç”¨äºAIå¤´åƒç”Ÿæˆï¼Œå¿…éœ€ï¼‰
LIBLIB_ACCESS_KEY=z8_g6KeL5Vac48fUL6am2A
LIBLIB_SECRET_KEY=FbPajEW5edStMVxBJuRUDu7fwr1Hy5Up
```

**è¯´æ˜**:
- è¿™äº›æ˜¯ä» api-proxy-endpoints.js ä¸­çš„é»˜è®¤å€¼å¤åˆ¶çš„
- å¦‚æœè¿™äº›å¯†é’¥æ— æ•ˆï¼Œéœ€è¦ç”¨æˆ·æä¾›è‡ªå·±çš„LiblibAIå¯†é’¥
- ä¿®æ”¹å**å¿…é¡»é‡å¯åç«¯æœåŠ¡å™¨**æ‰èƒ½ç”Ÿæ•ˆ

---

### ä¿®å¤2: TemplateSelectionPage æ•°æ®æµè½¬

**æ–‡ä»¶**: `src/pages/Festival/TemplateSelectionPage.tsx`

**ä¿®æ”¹å†…å®¹**:
1. æ·»åŠ å¯¼å…¥:
```typescript
import { getNavigationState } from '../../types/navigationState';
```

2. ä¿®å¤handleContinueå‡½æ•°:
```typescript
const handleContinue = () => {
  if (!selectedTemplate) {
    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿');
    return;
  }

  // âœ… æ¥æ”¶å¹¶ä¿ç•™ä»ä¸Šä¸€é¡µä¼ æ¥çš„NavigationState
  const navState = getNavigationState(location.state);

  // è·³è½¬åˆ°LabPageï¼Œåˆå¹¶NavigationStateå’Œæ¨¡æ¿é…ç½®
  navigate(`/festival/lab/${featureId}`, {
    state: {
      ...navState,  // âœ… ä¿ç•™åŸæœ‰NavigationState
      templateId: selectedTemplate.id,
      templateConfig: selectedTemplate.workflowConfig,
      selectedTemplate: selectedTemplate,
      gender: needsGender ? selectedGender : undefined,
      enableHairSwap: enableHairSwap
    }
  });
};
```

---

### ä¿®å¤3: M2TemplateSelectionPage æ•°æ®æµè½¬

**æ–‡ä»¶**: `src/pages/Festival/M2TemplateSelectionPage.tsx`

**ä¿®æ”¹å†…å®¹**:
1. æ·»åŠ å¯¼å…¥:
```typescript
import { getNavigationState } from '../../types/navigationState';
```

2. ä¿®å¤handleContinueå‡½æ•°:
```typescript
const handleContinue = () => {
  if (!selectedTemplate && !customTemplate) {
    alert('è¯·é€‰æ‹©ä¸€ä¸ªåœºæ™¯æ¨¡æ¿æˆ–ä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡');
    return;
  }

  // âœ… æ¥æ”¶å¹¶ä¿ç•™ä»ä¸Šä¸€é¡µä¼ æ¥çš„NavigationState
  const navState = getNavigationState(location.state);

  navigate('/festival/lab/M2', {
    state: {
      ...navState,  // âœ… ä¿ç•™åŸæœ‰NavigationState
      gender: selectedGender,
      templateId: useCustom ? 'custom' : selectedTemplate?.id,
      templateImagePath: useCustom ? customPreview : selectedTemplate?.imagePath,
      customTemplateFile: useCustom ? customTemplate : null,
      useCustomTemplate: useCustom,
      enableHairSwap: enableHairSwap,
      templateConfig: useCustom ? {
        templateImageUrl: customPreview
      } : {
        templateImageUrl: selectedTemplate?.imagePath
      }
    }
  });
};
```

---

## ğŸš€ å¯åŠ¨å‰åç«¯æœåŠ¡å™¨

### âš ï¸ é‡è¦ï¼šå¿…é¡»é‡å¯åç«¯ï¼

å› ä¸ºä¿®æ”¹äº† `.env` æ–‡ä»¶ï¼Œ**å¿…é¡»é‡å¯åç«¯æœåŠ¡å™¨**æ‰èƒ½åŠ è½½æ–°çš„ç¯å¢ƒå˜é‡ã€‚

### åç«¯å¯åŠ¨æ­¥éª¤

1. **å…³é—­å½“å‰åç«¯è¿›ç¨‹**ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰:
   - åœ¨åç«¯ç»ˆç«¯æŒ‰ `Ctrl+C`

2. **é‡æ–°å¯åŠ¨åç«¯**:
   ```bash
   cd F:\project_kuajing
   node server.js
   ```

3. **ç¡®è®¤åç«¯æ­£å¸¸è¿è¡Œ**:
   - åº”è¯¥çœ‹åˆ°: `Server running on http://192.168.2.2:3002`
   - åº”è¯¥çœ‹åˆ°: `âœ… [System] ç‰©ç†åˆ›å»º temp_processing æˆåŠŸ`

### å‰ç«¯å¯åŠ¨æ­¥éª¤

1. **å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨**ï¼ˆå¦‚æœæœªè¿è¡Œï¼‰:
   ```bash
   cd F:\project_kuajing
   npm run dev
   ```

2. **ç¡®è®¤å‰ç«¯æ­£å¸¸è¿è¡Œ**:
   - åº”è¯¥çœ‹åˆ°: `Local: http://192.168.2.2:5173`

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### å®Œæ•´æµç¨‹æµ‹è¯•

1. **è®¿é—®**: `http://192.168.2.2:5173`
2. **æµç¨‹**:
   - è¿›å…¥"è§†é¢‘åˆ¶ä½œ"é¡µé¢ (`/festival/video`)
   - ç‚¹å‡»"AIç”Ÿæˆ"å›¾ç‰‡
   - é€‰æ‹©"M1æ–°å¹´å¤´åƒ"
   - é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿
   - ä¸Šä¼ ä¸€å¼ äººè„¸ç…§ç‰‡
   - ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"
3. **é¢„æœŸç»“æœ**:
   - âœ… ä¸å†å‡ºç°"LIBLIBè°ƒç”¨å¤±è´¥"
   - âœ… æ­£å¸¸ç”Ÿæˆå›¾ç‰‡
   - âœ… è·³è½¬åˆ°ç»“æœé¡µé¢

### å¦‚æœä»ç„¶å¤±è´¥

å¦‚æœæµ‹è¯•åä»ç„¶å‡ºç°"LIBLIBè°ƒç”¨å¤±è´¥"ï¼Œå¯èƒ½åŸå› ï¼š

1. **LiblibAIå¯†é’¥æ— æ•ˆ**:
   - æ£€æŸ¥ `.env` ä¸­çš„ `LIBLIB_ACCESS_KEY` å’Œ `LIBLIB_SECRET_KEY`
   - ç™»å½• LiblibAI å®˜ç½‘è·å–æ–°çš„å¯†é’¥
   - æ›´æ–° `.env` åé‡å¯åç«¯

2. **åç«¯æœªé‡å¯**:
   - ç¡®è®¤å·²å…³é—­æ—§çš„åç«¯è¿›ç¨‹
   - é‡æ–°è¿è¡Œ `node server.js`

3. **LiblibAI APIæœ¬èº«é—®é¢˜**:
   - æ£€æŸ¥ LiblibAI å®˜ç½‘æ˜¯å¦æ­£å¸¸
   - æŸ¥çœ‹åç«¯ç»ˆç«¯çš„é”™è¯¯æ—¥å¿—
   - å¯èƒ½éœ€è¦è”ç³» LiblibAI æŠ€æœ¯æ”¯æŒ

---

## ğŸ“‹ ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `.env` | âœ… å·²ä¿®æ”¹ | æ·»åŠ LIBLIBå¯†é’¥ |
| `src/pages/Festival/TemplateSelectionPage.tsx` | âœ… å·²ä¿®æ”¹ | æ¥æ”¶å¹¶ä¼ é€’NavigationState |
| `src/pages/Festival/M2TemplateSelectionPage.tsx` | âœ… å·²ä¿®æ”¹ | æ¥æ”¶å¹¶ä¼ é€’NavigationState |

---

## ğŸ”„ æ•°æ®æµè½¬å›¾ï¼ˆä¿®å¤åï¼‰

```
VideoPage (ä¼ é€’ NavigationState)
    â†“ state: { text, audio, image, ... }
ImageGeneratorSelector
    â†“ ç”¨æˆ·é€‰æ‹© M1 æˆ– M2
TemplateSelectionPage
    â†“ state: { ...navState, templateId, templateConfig, gender, ... } âœ…
LabPage
    â†“ æ¥æ”¶å®Œæ•´çš„stateï¼ˆè™½ç„¶ä¸ä½¿ç”¨navStateï¼Œä½†æµè½¬å®Œæ•´ï¼‰
MissionExecutor
    â†“ è°ƒç”¨ LiblibProxy
LiblibProxy
    â†“ è°ƒç”¨åç«¯ä»£ç† /api/liblib/text2img
Backend api-proxy-endpoints.js
    â†“ ä½¿ç”¨ LIBLIB_ACCESS_KEY + LIBLIB_SECRET_KEY âœ…
LiblibAI API
    â†“ è¿”å›ç”Ÿæˆçš„å›¾ç‰‡
```

---

## âš ï¸ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼ˆå¿…é¡»ï¼‰:

1. **é‡å¯åç«¯æœåŠ¡å™¨** (Ctrl+C ç„¶å `node server.js`)
2. **ç¡®è®¤å‰ç«¯æ­£åœ¨è¿è¡Œ** (`npm run dev`)
3. **æµ‹è¯•å®Œæ•´æµç¨‹**ï¼ˆå‚è€ƒä¸Šé¢çš„æµ‹è¯•æµç¨‹ï¼‰

### å¦‚æœæµ‹è¯•æˆåŠŸ:

- âœ… å¯ä»¥æäº¤ä»£ç 
- âœ… ç»§ç»­å¼€å‘å…¶ä»–åŠŸèƒ½

### å¦‚æœæµ‹è¯•å¤±è´¥:

- âŒ æ£€æŸ¥åç«¯ç»ˆç«¯çš„é”™è¯¯æ—¥å¿—
- âŒ ç¡®è®¤ LiblibAI å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
- âŒ è”ç³»æˆ‘è¿›è¡Œæ·±åº¦æ’æŸ¥

---

## ğŸ“ æŠ€æœ¯è¯´æ˜

### ä¸ºä»€ä¹ˆä¿®æ”¹.envéœ€è¦é‡å¯åç«¯ï¼Ÿ

Node.js åœ¨å¯åŠ¨æ—¶é€šè¿‡ `require('dotenv').config()` ä¸€æ¬¡æ€§åŠ è½½ç¯å¢ƒå˜é‡åˆ° `process.env`ã€‚è¿è¡Œæ—¶ä¿®æ”¹ `.env` æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨æ›´æ–° `process.env`ï¼Œå¿…é¡»é‡å¯è¿›ç¨‹ã€‚

### ä¸ºä»€ä¹ˆä¿®æ”¹å‰ç«¯ä»£ç ä¸éœ€è¦é‡å¯ï¼Ÿ

å‰ç«¯ä½¿ç”¨ Vite å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ï¼Œä¿®æ”¹ä»£ç åä¼šè‡ªåŠ¨é‡æ–°ç¼–è¯‘å’Œæ›´æ–°æµè§ˆå™¨ã€‚

---

## ğŸ¯ å®Œæˆæ ‡å¿—

å½“ä½ èƒ½å¤Ÿå®Œæˆä»¥ä¸‹æµ‹è¯•ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼š

- [ ] åç«¯æˆåŠŸå¯åŠ¨ï¼ˆç«¯å£3002ï¼‰
- [ ] å‰ç«¯æˆåŠŸå¯åŠ¨ï¼ˆç«¯å£5173ï¼‰
- [ ] VideoPage â†’ M1æ¨¡æ¿ â†’ ä¸Šä¼ ç…§ç‰‡ â†’ ç”ŸæˆæˆåŠŸ
- [ ] ä¸å†å‡ºç°"LIBLIBè°ƒç”¨å¤±è´¥"é”™è¯¯
- [ ] ç”Ÿæˆçš„å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- [ ] å¯ä»¥ä¿å­˜åˆ°ç´ æåº“

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2026-02-08
**ä¿®å¤çŠ¶æ€**: âœ… ä»£ç å·²ä¿®å¤ï¼Œç­‰å¾…æµ‹è¯•ç¡®è®¤
