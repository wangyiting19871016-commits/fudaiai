# å¡«ç©ºå¼æµ·æŠ¥ç³»ç»Ÿ - å¼€å‘æŒ‡å—

**ä¸‡é‡‘æ²¹æ–¹æ¡ˆ** - æ¨¡æ¿é©±åŠ¨çš„æµ·æŠ¥ç”Ÿæˆç³»ç»Ÿ

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æ ¸å¿ƒæ–‡ä»¶](#æ ¸å¿ƒæ–‡ä»¶)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¨¡æ¿é…ç½®](#æ¨¡æ¿é…ç½®)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [æ‰©å±•å¼€å‘](#æ‰©å±•å¼€å‘)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç†å¿µ

**ä¸‡é‡‘æ²¹æ–¹æ¡ˆï¼ˆUniversal Solutionï¼‰**ï¼šæ¨¡æ¿é©±åŠ¨ï¼Œé…ç½®åŒ–ï¼Œæ”¯æŒæœªæ¥è®¾è®¡å˜æ›´

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **æ¨¡æ¿é©±åŠ¨** - JSONé…ç½®ï¼Œæ— éœ€æ”¹ä»£ç å³å¯æ›´æ¢è®¾è®¡
âœ… **é«˜åº¦çµæ´»** - æ”¯æŒæ˜¥è”ã€è¾¹æ¡†ã€æ–‡å­—ã€è£…é¥°ç­‰å¤šç§å…ƒç´ 
âœ… **æ— é®æŒ¡è®¾è®¡** - ç²¾ç¡®çš„åŒºåŸŸåˆ’åˆ†ï¼Œ15pxå®‰å…¨é—´è·
âœ… **æ°´å°ç³»ç»Ÿ** - é›†æˆç°æœ‰`addWatermark.ts`ï¼Œå“ç‰ŒLogo+äºŒç»´ç å¯ç§»é™¤
âœ… **å“ç‰Œä¸€è‡´æ€§** - ä½¿ç”¨CSSå˜é‡å®šä¹‰çš„å“ç‰Œè‰²

### æŠ€æœ¯æ ˆ

- **Canvas API** - å›¾ç‰‡ç”Ÿæˆ
- **TypeScript** - ç±»å‹å®‰å…¨
- **React Hooks** - çŠ¶æ€ç®¡ç†
- **CSS Variables** - å“ç‰Œè‰²ç³»ç»Ÿ

---

## æ ¸å¿ƒæ–‡ä»¶

### 1. æ¨¡æ¿é…ç½®

**æ–‡ä»¶**: `src/configs/festival/posterTemplates.ts`

å®šä¹‰æµ·æŠ¥æ¨¡æ¿çš„æ‰€æœ‰é…ç½®ï¼ŒåŒ…æ‹¬ï¼š
- Canvaså°ºå¯¸å’ŒèƒŒæ™¯è‰²
- ä¸»å›¾ç‰‡åŒºåŸŸå’Œè£å‰ªæ–¹å¼
- æ˜¥è”é…ç½®ï¼ˆä½ç½®ã€å­—ä½“ã€é¢œè‰²ï¼‰
- è£…é¥°å…ƒç´ ï¼ˆè¾¹æ¡†ã€æ¸å˜ï¼‰
- æ–‡å­—åŒºåŸŸ
- æ°´å°é…ç½®

```typescript
import { CLASSIC_COUPLET_POSTER, getPosterTemplate } from '@/configs/festival/posterTemplates';

// è·å–é¢„è®¾æ¨¡æ¿
const template = getPosterTemplate('classic-couplet');
```

### 2. Canvasæ¸²æŸ“å™¨

**æ–‡ä»¶**: `src/utils/posterCanvas.ts`

è¯»å–æ¨¡æ¿é…ç½®ï¼Œæ¸²æŸ“æµ·æŠ¥å›¾ç‰‡ï¼š
- èƒŒæ™¯å’Œè£…é¥°å…ƒç´ 
- æ˜¥è”æ–‡å­—ï¼ˆç«–æ’/æ¨ªæ’ï¼‰
- ä¸»å›¾ç‰‡ï¼ˆcover/contain/fillï¼‰
- æ–‡å­—åŒºåŸŸ
- æ°´å°ï¼ˆé›†æˆ`addWatermark.ts`ï¼‰

```typescript
import { generatePoster } from '@/utils/posterCanvas';

const dataUrl = await generatePoster(template, posterData);
```

### 3. React Hook

**æ–‡ä»¶**: `src/hooks/usePosterGenerator.ts`

ç®€åŒ–Reactç»„ä»¶ä¸­çš„æµ·æŠ¥ç”Ÿæˆæµç¨‹ï¼š
- ç”ŸæˆçŠ¶æ€ç®¡ç†
- é”™è¯¯å¤„ç†
- ä¸‹è½½åŠŸèƒ½

```typescript
import { usePosterGenerator } from '@/hooks/usePosterGenerator';

const { generate, download, isGenerating } = usePosterGenerator({ template });
```

### 4. æ°´å°ç³»ç»Ÿï¼ˆå·²æœ‰ï¼‰

**æ–‡ä»¶**: `src/utils/addWatermark.ts`

ç°æœ‰çš„æ°´å°ç³»ç»Ÿï¼Œæ·»åŠ Logo+äºŒç»´ç ï¼š
- ä½ç½®ï¼šå³ä¸‹è§’
- å¯é…ç½®å¤§å°
- åŠé€æ˜èƒŒæ™¯
- ä»˜è´¹å¯ç§»é™¤

---

## å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨

```tsx
import { useState } from 'react';
import { usePosterGenerator } from '@/hooks/usePosterGenerator';
import { CLASSIC_COUPLET_POSTER } from '@/configs/festival/posterTemplates';

function PosterGenerator() {
  const [imageUrl, setImageUrl] = useState('');

  const { generate, download, isGenerating, posterDataUrl } = usePosterGenerator({
    template: CLASSIC_COUPLET_POSTER,
    onSuccess: (dataUrl) => console.log('æµ·æŠ¥ç”ŸæˆæˆåŠŸï¼'),
    onError: (error) => console.error('ç”Ÿæˆå¤±è´¥ï¼š', error),
  });

  const handleGenerate = async () => {
    await generate({
      mainImageUrl: imageUrl,
      couplet: {
        upperLine: 'æ˜¥é£å¾—æ„é©¬è¹„ç–¾',
        lowerLine: 'ä¸€æ—¥çœ‹å°½é•¿å®‰èŠ±',
        horizontalScroll: 'é©¬åˆ°æˆåŠŸ',
      },
      text: {
        title: 'ç¦è¢‹AIÂ·é©¬å¹´å¤§å‰',
        subtitle: 'ç¥æ‚¨æ–°æ˜¥å¿«ä¹',
      },
      watermarkOverride: {
        qrCodeUrl: 'https://example.com/qr-code.png',
      },
    });
  };

  return (
    <div>
      <input
        type="text"
        value={imageUrl}
        onChange={(e) => setImageUrl(e.target.value)}
        placeholder="è¾“å…¥å›¾ç‰‡URL"
      />
      <button onClick={handleGenerate} disabled={isGenerating}>
        {isGenerating ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆæµ·æŠ¥'}
      </button>
      {posterDataUrl && (
        <>
          <img src={posterDataUrl} alt="ç”Ÿæˆçš„æµ·æŠ¥" />
          <button onClick={() => download('æˆ‘çš„æµ·æŠ¥.png')}>ä¸‹è½½æµ·æŠ¥</button>
        </>
      )}
    </div>
  );
}
```

### 2. ç›´æ¥è°ƒç”¨ï¼ˆæ— Reactï¼‰

```typescript
import { generatePoster, downloadPoster } from '@/utils/posterCanvas';
import { CLASSIC_COUPLET_POSTER } from '@/configs/festival/posterTemplates';

async function createPoster() {
  const dataUrl = await generatePoster(CLASSIC_COUPLET_POSTER, {
    mainImageUrl: 'https://example.com/photo.jpg',
    couplet: {
      upperLine: 'æ˜¥é£å¾—æ„é©¬è¹„ç–¾',
      lowerLine: 'ä¸€æ—¥çœ‹å°½é•¿å®‰èŠ±',
      horizontalScroll: 'é©¬åˆ°æˆåŠŸ',
    },
  });

  downloadPoster(dataUrl, 'ç¦è¢‹AIæµ·æŠ¥.png');
}
```

---

## æ¨¡æ¿é…ç½®

### é¢„è®¾æ¨¡æ¿

#### 1. ç»å…¸æ˜¥è”æµ·æŠ¥ (`classic-couplet`)

750Ã—1334pxï¼Œå·¦å³æ˜¥è”è£…é¥°ï¼Œé€‚åˆæ–°å¹´ç¥ç¦

```typescript
import { CLASSIC_COUPLET_POSTER } from '@/configs/festival/posterTemplates';
```

**å¸ƒå±€è¯´æ˜**ï¼š
- å·¦æ˜¥è”ï¼š50pxï¼ˆè·å·¦è¾¹ç¼˜50pxï¼‰
- ä¸»å›¾ç‰‡ï¼š500pxï¼ˆå±…ä¸­ï¼‰
- å³æ˜¥è”ï¼š50pxï¼ˆè·å³è¾¹ç¼˜50pxï¼‰
- å®‰å…¨é—´è·ï¼š15px

**ç‰¹ç‚¹**ï¼š
- çº¢åº•é‡‘å­—æ˜¥è”
- ç«–æ’æ–‡å­—
- æ¨ªæ‰¹é¡¶éƒ¨å±…ä¸­
- è£…é¥°è¾¹æ¡†å’Œæ¸å˜

#### 2. ç®€çº¦è¾¹æ¡†æµ·æŠ¥ (`minimal-frame`)

ç®€æ´åŒå±‚è¾¹æ¡†ï¼Œç°ä»£é£æ ¼

```typescript
import { MINIMAL_FRAME_POSTER } from '@/configs/festival/posterTemplates';
```

#### 3. å…¨å±ç…§ç‰‡æµ·æŠ¥ (`fullscreen-photo`)

æ— è¾¹æ¡†ï¼Œä»…æ·»åŠ æ°´å°

```typescript
import { FULLSCREEN_PHOTO_POSTER } from '@/configs/festival/posterTemplates';
```

### è‡ªå®šä¹‰æ¨¡æ¿

#### åˆ›å»ºæ–°æ¨¡æ¿

```typescript
import type { PosterTemplate } from '@/configs/festival/posterTemplates';

export const MY_CUSTOM_TEMPLATE: PosterTemplate = {
  id: 'my-custom-template',
  name: 'æˆ‘çš„è‡ªå®šä¹‰æ¨¡æ¿',
  description: 'æ¨¡æ¿æè¿°',

  canvas: {
    width: 750,
    height: 1334,
    backgroundColor: '#FFF8F0',  // ä½¿ç”¨CSSå˜é‡ï¼švar(--cny-bg-warm)
  },

  mainImage: {
    region: {
      x: 100,
      y: 200,
      width: 550,
      height: 733,
    },
    fit: 'cover',
    borderRadius: 16,
  },

  // å¯é€‰ï¼šæ˜¥è”é…ç½®
  couplet: {
    upper: {
      region: { x: 670, y: 200, width: 50, height: 733 },
      fontSize: 28,
      fontFamily: '"Noto Serif SC", "STKaiti", "KaiTi", serif',
      color: '#FFD700',           // var(--cny-gold-500)
      backgroundColor: '#E53935', // var(--cny-red-500)
      verticalText: true,
      letterSpacing: 12,
    },
    lower: {
      region: { x: 30, y: 200, width: 50, height: 733 },
      fontSize: 28,
      fontFamily: '"Noto Serif SC", "STKaiti", "KaiTi", serif',
      color: '#FFD700',
      backgroundColor: '#E53935',
      verticalText: true,
      letterSpacing: 12,
    },
  },

  // å¯é€‰ï¼šè£…é¥°å…ƒç´ 
  decorations: [
    {
      type: 'border',
      region: { x: 90, y: 190, width: 570, height: 753 },
      style: {
        color: '#FFD700',
        lineWidth: 4,
        borderRadius: 20,
      },
    },
  ],

  // å¯é€‰ï¼šæ–‡å­—åŒºåŸŸ
  textRegions: {
    title: {
      region: { x: 75, y: 1000, width: 600, height: 80 },
      fontSize: 48,
      fontFamily: '"Noto Serif SC", serif',
      color: '#E53935',
      textAlign: 'center',
      lineHeight: 1.5,
    },
  },

  // æ°´å°é…ç½®
  watermark: {
    enabled: true,
    size: 0.12,
    position: 'bottom-right',
    text: 'ç¦è¢‹AIåˆ¶ä½œ',
  },
};
```

#### æ³¨å†Œè‡ªå®šä¹‰æ¨¡æ¿

åœ¨ `posterTemplates.ts` ä¸­æ·»åŠ ï¼š

```typescript
export const POSTER_TEMPLATES: Record<string, PosterTemplate> = {
  'classic-couplet': CLASSIC_COUPLET_POSTER,
  'minimal-frame': MINIMAL_FRAME_POSTER,
  'fullscreen-photo': FULLSCREEN_PHOTO_POSTER,
  'my-custom-template': MY_CUSTOM_TEMPLATE,  // æ–°å¢
};
```

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç”Ÿæˆæ˜¥è”æµ·æŠ¥

```typescript
import { generatePoster } from '@/utils/posterCanvas';
import { CLASSIC_COUPLET_POSTER } from '@/configs/festival/posterTemplates';

const posterData = {
  mainImageUrl: 'https://example.com/user-photo.jpg',
  couplet: {
    upperLine: 'ç¦æ»¡ä¹¾å¤æ˜¥å¸¸åœ¨',
    lowerLine: 'è´¢è¿›å®¶é—¨å–œäº‹å¤š',
    horizontalScroll: 'å‰ç¥¥å¦‚æ„',
  },
  text: {
    title: 'æ­è´ºæ–°ç¦§',
    subtitle: 'ç¦è¢‹AIç¥æ‚¨é©¬å¹´å¤§å‰',
  },
  watermarkOverride: {
    qrCodeUrl: 'https://example.com/qr.png',
    text: 'ç¦è¢‹AIåˆ¶ä½œ',
  },
};

const dataUrl = await generatePoster(CLASSIC_COUPLET_POSTER, posterData);
```

### ç¤ºä¾‹2ï¼šç®€çº¦è¾¹æ¡†æµ·æŠ¥ï¼ˆæ— æ˜¥è”ï¼‰

```typescript
import { MINIMAL_FRAME_POSTER } from '@/configs/festival/posterTemplates';

const posterData = {
  mainImageUrl: 'https://example.com/photo.jpg',
  text: {
    title: 'æ–°æ˜¥å¿«ä¹',
  },
  watermarkOverride: {
    enabled: false,  // ä»˜è´¹ç”¨æˆ·å¯å…³é—­æ°´å°
  },
};

const dataUrl = await generatePoster(MINIMAL_FRAME_POSTER, posterData);
```

### ç¤ºä¾‹3ï¼šå…¨å±ç…§ç‰‡ï¼ˆä»…æ°´å°ï¼‰

```typescript
import { FULLSCREEN_PHOTO_POSTER } from '@/configs/festival/posterTemplates';

const posterData = {
  mainImageUrl: 'https://example.com/full-photo.jpg',
};

const dataUrl = await generatePoster(FULLSCREEN_PHOTO_POSTER, posterData);
```

### ç¤ºä¾‹4ï¼šä¸AIç”Ÿæˆå›¾ç‰‡é›†æˆ

```typescript
import { generatePoster } from '@/utils/posterCanvas';
import { CLASSIC_COUPLET_POSTER } from '@/configs/festival/posterTemplates';
import { executeImageGeneration } from '@/services/missionExecutor';

async function generateAIPoster() {
  // 1. ä½¿ç”¨LiblibAIç”Ÿæˆå›¾ç‰‡
  const result = await executeImageGeneration({
    featureId: 'M7',
    prompt: 'ä¸€åŒ¹éªé©¬å¥”è·‘åœ¨æ˜¥å¤©çš„è‰åŸä¸Š',
    // ...å…¶ä»–å‚æ•°
  });

  // 2. ç”Ÿæˆæµ·æŠ¥
  const posterData = {
    mainImageUrl: result.imageUrl,
    couplet: {
      upperLine: 'é©¬åˆ°æˆåŠŸåƒé‡Œå¿—',
      lowerLine: 'æ˜¥å›å¤§åœ°ä¸‡å®¶æ¬¢',
      horizontalScroll: 'é©¬å¹´å¤§å‰',
    },
  };

  const posterUrl = await generatePoster(CLASSIC_COUPLET_POSTER, posterData);

  return posterUrl;
}
```

---

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°è£…é¥°ç±»å‹

åœ¨ `posterCanvas.ts` çš„ `drawDecoration` å‡½æ•°ä¸­æ·»åŠ æ–°ç±»å‹ï¼š

```typescript
case 'pattern':
  // è‡ªå®šä¹‰å›¾æ¡ˆè£…é¥°
  const pattern = ctx.createPattern(patternImage, 'repeat');
  if (pattern) {
    ctx.fillStyle = pattern;
    ctx.fillRect(region.x, region.y, region.width, region.height);
  }
  break;

case 'image':
  // è£…é¥°å›¾ç‰‡
  if (style.imageSrc) {
    const decorImg = await loadImage(style.imageSrc);
    ctx.drawImage(decorImg, region.x, region.y, region.width, region.height);
  }
  break;
```

### æ”¯æŒå¤šè¡Œæ–‡å­—è‡ªåŠ¨æ¢è¡Œ

åœ¨ `drawTextRegion` å‡½æ•°ä¸­æ·»åŠ æ–‡å­—æ¢è¡Œé€»è¾‘ï¼š

```typescript
function drawMultilineText(
  ctx: CanvasRenderingContext2D,
  text: string,
  x: number,
  y: number,
  maxWidth: number,
  lineHeight: number
) {
  const words = text.split('');
  let line = '';
  let currentY = y;

  for (let i = 0; i < words.length; i++) {
    const testLine = line + words[i];
    const metrics = ctx.measureText(testLine);

    if (metrics.width > maxWidth && i > 0) {
      ctx.fillText(line, x, currentY);
      line = words[i];
      currentY += lineHeight;
    } else {
      line = testLine;
    }
  }

  ctx.fillText(line, x, currentY);
}
```

### æ·»åŠ åŠ¨ç”»æ•ˆæœï¼ˆCanvasåŠ¨ç”»ï¼‰

```typescript
export async function generateAnimatedPoster(
  template: PosterTemplate,
  data: PosterData,
  frames: number = 30
): Promise<Blob[]> {
  const frameBlobs: Blob[] = [];

  for (let i = 0; i < frames; i++) {
    const progress = i / frames;

    // ä¿®æ”¹æ¨¡æ¿é…ç½®ä»¥å®ç°åŠ¨ç”»æ•ˆæœ
    const animatedTemplate = {
      ...template,
      mainImage: {
        ...template.mainImage,
        region: {
          ...template.mainImage.region,
          y: template.mainImage.region.y + Math.sin(progress * Math.PI * 2) * 10,
        },
      },
    };

    const dataUrl = await generatePoster(animatedTemplate, data);
    const blob = await fetch(dataUrl).then(r => r.blob());
    frameBlobs.push(blob);
  }

  return frameBlobs;
}
```

---

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å“ç‰Œè‰²

å§‹ç»ˆä½¿ç”¨CSSå˜é‡å®šä¹‰çš„å“ç‰Œè‰²ï¼Œç¡®ä¿ä¸€è‡´æ€§ï¼š

```typescript
// âœ… æ¨è
backgroundColor: '#E53935',  // --cny-red-500
color: '#FFD700',            // --cny-gold-500

// âŒ ä¸æ¨è
backgroundColor: '#FF0000',  // éšæ„çš„çº¢è‰²
```

### 2. ä¿æŒå®‰å…¨é—´è·

ç¡®ä¿å…ƒç´ ä¹‹é—´æœ‰è¶³å¤Ÿçš„é—´è·ï¼Œé¿å…é®æŒ¡ï¼š

```typescript
// ç»å…¸æ˜¥è”å¸ƒå±€ç¤ºä¾‹
const SAFE_GAP = 15;  // å®‰å…¨é—´è·

const layout = {
  leftCouplet: { x: 50, width: 50 },
  mainImage: { x: 50 + 50 + SAFE_GAP, width: 500 },
  rightCouplet: { x: 50 + 50 + SAFE_GAP + 500 + SAFE_GAP, width: 50 },
};
```

### 3. å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†

```typescript
const { generate, error } = usePosterGenerator({
  template: CLASSIC_COUPLET_POSTER,
  onError: (error) => {
    if (error.message.includes('Failed to load image')) {
      toast.error('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å›¾ç‰‡URL');
    }
  },
});
```

### 4. æ€§èƒ½ä¼˜åŒ–

```typescript
// ç¼“å­˜å·²ç”Ÿæˆçš„æµ·æŠ¥
const posterCache = new Map<string, string>();

async function getCachedPoster(cacheKey: string, generator: () => Promise<string>) {
  if (posterCache.has(cacheKey)) {
    return posterCache.get(cacheKey)!;
  }

  const dataUrl = await generator();
  posterCache.set(cacheKey, dataUrl);
  return dataUrl;
}
```

### 5. æ°´å°ç®¡ç†

```typescript
// æ ¹æ®ç”¨æˆ·ä¼šå‘˜çŠ¶æ€å†³å®šæ˜¯å¦æ˜¾ç¤ºæ°´å°
const posterData = {
  mainImageUrl: imageUrl,
  watermarkOverride: {
    enabled: !user.isPremium,  // ä»˜è´¹ç”¨æˆ·æ— æ°´å°
    qrCodeUrl: user.referralQrCode,
    text: user.isPremium ? undefined : 'ç¦è¢‹AIåˆ¶ä½œ',
  },
};
```

### 6. æ¨¡æ¿é€‰æ‹©é€»è¾‘

```typescript
function selectTemplate(userPreference: string, imageAspectRatio: number): PosterTemplate {
  // æ ¹æ®ç”¨æˆ·åå¥½å’Œå›¾ç‰‡æ¯”ä¾‹é€‰æ‹©åˆé€‚çš„æ¨¡æ¿
  if (userPreference === 'classic') {
    return CLASSIC_COUPLET_POSTER;
  }

  if (imageAspectRatio > 1.5) {
    // ç«–å›¾ï¼Œä½¿ç”¨å…¨å±æ¨¡æ¿
    return FULLSCREEN_PHOTO_POSTER;
  }

  // é»˜è®¤ä½¿ç”¨ç®€çº¦è¾¹æ¡†
  return MINIMAL_FRAME_POSTER;
}
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ›´æ¢æ˜¥è”è®¾è®¡ï¼Ÿ

**A**: åªéœ€ä¿®æ”¹æ¨¡æ¿é…ç½®ï¼Œæ— éœ€æ”¹åŠ¨ä»£ç ï¼š

```typescript
// åœ¨ posterTemplates.ts ä¸­ä¿®æ”¹
export const CLASSIC_COUPLET_POSTER: PosterTemplate = {
  // ...
  couplet: {
    upper: {
      // ä¿®æ”¹å­—ä½“å¤§å°
      fontSize: 32,  // åŸæ¥æ˜¯28
      // ä¿®æ”¹é¢œè‰²
      color: '#FFA726',  // æ©™é‡‘è‰²
      // ä¿®æ”¹èƒŒæ™¯
      backgroundColor: '#D32F2F',  // æ·±çº¢è‰²
    },
    // ...
  },
};
```

### Q2: å¦‚ä½•æ”¯æŒæ¨ªæ’æ˜¥è”ï¼Ÿ

**A**: è®¾ç½® `verticalText: false`ï¼š

```typescript
couplet: {
  upper: {
    // ...
    verticalText: false,  // æ¨ªæ’
  },
}
```

### Q3: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å­—ä½“ï¼Ÿ

**A**: åœ¨ `fontFamily` ä¸­æŒ‡å®šWebå­—ä½“ï¼š

```typescript
// 1. åœ¨HTMLä¸­åŠ è½½å­—ä½“
<link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">

// 2. åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
couplet: {
  upper: {
    fontFamily: '"Ma Shan Zheng", "STKaiti", serif',
  },
}
```

### Q4: ç”Ÿæˆçš„å›¾ç‰‡æ¨¡ç³Šæ€ä¹ˆåŠï¼Ÿ

**A**: ä½¿ç”¨é«˜DPRï¼ˆè®¾å¤‡åƒç´ æ¯”ï¼‰æ¸²æŸ“ï¼š

```typescript
// åœ¨ posterCanvas.ts çš„ generatePoster å‡½æ•°ä¸­
const dpr = window.devicePixelRatio || 2;
canvas.width = template.canvas.width * dpr;
canvas.height = template.canvas.height * dpr;
ctx.scale(dpr, dpr);
```

### Q5: å¦‚ä½•å¯¼å‡ºä¸ºJPGæ ¼å¼ï¼Ÿ

**A**: ä¿®æ”¹ `toDataURL` å‚æ•°ï¼š

```typescript
// PNGï¼ˆé»˜è®¤ï¼Œæ”¯æŒé€æ˜ï¼‰
canvas.toDataURL('image/png');

// JPGï¼ˆæ–‡ä»¶æ›´å°ï¼Œä¸æ”¯æŒé€æ˜ï¼‰
canvas.toDataURL('image/jpeg', 0.9);  // 0.9æ˜¯è´¨é‡ï¼ˆ0-1ï¼‰
```

---

## ç›¸å…³æ–‡æ¡£

- [å¼€å‘è§„èŒƒ.md](./å¼€å‘è§„èŒƒ.md) - CSSä¿®æ”¹è§„èŒƒï¼Œå¿…è¯»
- [æŠ€æœ¯æ–‡æ¡£.md](./æŠ€æœ¯æ–‡æ¡£.md) - æŠ€æœ¯å®ç°ç»†èŠ‚
- [äº§å“åŠŸèƒ½æ¸…å•.md](./äº§å“åŠŸèƒ½æ¸…å•.md) - äº§å“åŠŸèƒ½è¯´æ˜

---

**ä¸‡é‡‘æ²¹æ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³**ï¼š
> æ¨¡æ¿å¯æ¢ï¼Œä»£ç ä¸å˜ã€‚è®¾è®¡å¸ˆä¿®æ”¹JSONé…ç½®ï¼Œå¼€å‘è€…æ— éœ€æ”¹ä»£ç ã€‚

**æœ€åæ›´æ–°**: 2026-02-01
**ç»´æŠ¤è€…**: ç¦è¢‹AIå›¢é˜Ÿ
