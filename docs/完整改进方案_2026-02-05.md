# ç¦è¢‹AIÂ·å®Œæ•´æ”¹è¿›æ–¹æ¡ˆ

**åˆ›å»ºæ—¶é—´**: 2026-02-05 21:25
**çŠ¶æ€**: åŸºç¡€é—®é¢˜å·²ä¿®å¤ï¼Œè®¾è®¡ä¼˜åŒ–å¾…å®æ–½

---

## âœ… å·²ä¿®å¤é—®é¢˜

### 1. ä¿å­˜åŠŸèƒ½ä¿®å¤

**é—®é¢˜**ï¼šç‚¹å‡»"ä¿å­˜è§†é¢‘åˆ°ç›¸å†Œ"å®é™…æ˜¯ä¸‹è½½ï¼Œç”¨æˆ·ä½“éªŒæ··ä¹±

**æ ¹æœ¬åŸå› **ï¼šWeb APIæ— æ³•ç›´æ¥ä¿å­˜åˆ°ç³»ç»Ÿç›¸å†Œï¼Œåªèƒ½è§¦å‘ä¸‹è½½

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç§»é™¤ä¸å¯é çš„Web Share API
- æ”¹ä¸ºç›´æ¥ä¸‹è½½ + æ¸…æ™°çš„å¼•å¯¼å¼¹çª—
- æŒ‰é’®æ–‡æ¡ˆç»Ÿä¸€ä¸º"ä¿å­˜è§†é¢‘"/"ä¿å­˜å›¾ç‰‡"
- ç§»åŠ¨ç«¯ä¸‹è½½åæ˜¾ç¤ºå¼•å¯¼å¼¹çª—ï¼Œå‘Šè¯‰ç”¨æˆ·å¦‚ä½•ç§»åŠ¨åˆ°ç›¸å†Œ

**iOSå¼•å¯¼**ï¼š
1. è§†é¢‘å·²ä¿å­˜åˆ°"æ–‡ä»¶"Appçš„"ä¸‹è½½"æ–‡ä»¶å¤¹
2. æ‰“å¼€"æ–‡ä»¶"Appï¼Œæ‰¾åˆ°ä¸‹è½½çš„è§†é¢‘
3. é•¿æŒ‰è§†é¢‘ï¼Œé€‰æ‹©"å­˜å‚¨è§†é¢‘"
4. è§†é¢‘å°†ä¿å­˜åˆ°ç›¸å†Œä¸­

**Androidå¼•å¯¼**ï¼š
1. è§†é¢‘å·²ä¿å­˜åˆ°"Downloads"æ–‡ä»¶å¤¹
2. æ‰“å¼€"ç›¸å†Œ"æˆ–"å›¾åº“"App
3. æŸ¥çœ‹"ä¸‹è½½"æˆ–"Downloads"ç›¸å†Œ
4. è§†é¢‘å·²åœ¨ç›¸å†Œä¸­

**æ–‡ä»¶ä¿®æ”¹**ï¼š
- `src/services/SaveToAlbumService.tsx` - å®Œå…¨é‡å†™

---

### 2. è§†é¢‘ç»“æœé¡µé‡è®¾è®¡

**é—®é¢˜**ï¼š
- "åˆ¶ä½œè¯­éŸ³"æŒ‰é’®ä¸åˆç†ï¼ˆè§†é¢‘éƒ½åšå¥½äº†ï¼‰
- ç¼ºå°‘æ™ºèƒ½æ¨è

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç§»é™¤"åˆ¶ä½œè¯­éŸ³"æŒ‰é’®
- é›†æˆ `ContinueCreationPanel` ç»„ä»¶
- æ™ºèƒ½æ¨èæœªä½¿ç”¨çš„åŠŸèƒ½ï¼ˆé«˜æƒ…å•†å›å¤ã€è¿åŠ¿æŠ½å¡ç­‰ï¼‰
- è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·å·²å®Œæˆçš„æµç¨‹ï¼Œæ¨èè¡¥å……åŠŸèƒ½

**æŒ‰é’®å¸ƒå±€**ï¼š
```
[ä¿å­˜è§†é¢‘]ï¼ˆä¸»æŒ‰é’®ï¼Œå…¨å®½ï¼‰
[é‡æ–°ç”Ÿæˆ] [è¿”å›é¦–é¡µ]

ã€ç»§ç»­åˆ›ä½œã€‘ï¼ˆæ™ºèƒ½æ¨èé¢æ¿ï¼‰
- é«˜æƒ…å•†å›å¤
- è¿åŠ¿æŠ½å¡
- AIæ˜¥è”
- å…¶ä»–æœªä½¿ç”¨åŠŸèƒ½
```

**æ–‡ä»¶ä¿®æ”¹**ï¼š
- `src/pages/Festival/VideoPage.tsx` - é›†æˆContinueCreationPanel

---

### 3. å¿«é€Ÿæ–‡æ¡ˆæ¨¡æ¿

**å·²å®æ–½**ï¼š
- æ‰©å±•TEXT_TEMPLATESä»6æ¡å¢åŠ åˆ°15æ¡
- åˆ›å»ºTextTemplateSelectorç»„ä»¶
- æ·»åŠ å­—æ•°æç¤ºå’Œæ—¶é•¿ä¼°ç®—
- è¶…è¿‡80å­—è­¦å‘Š

---

### 4. ç”ŸæˆåŠ¨ç”»

**å·²å®æ–½**ï¼š
- åŠ è½½å›¾æ ‡ + è¿›åº¦æ¡ + ç™¾åˆ†æ¯”
- å®æ—¶æ­¥éª¤æç¤º
- é¢„è®¡æ—¶é—´æç¤ºï¼ˆ30-60ç§’ï¼‰

---

## âš ï¸ å¾…è§£å†³é—®é¢˜

### 1. å­—å¹•çƒ§å½•ï¼ˆå…³é”®é—®é¢˜ï¼‰

**å½“å‰çŠ¶æ€**ï¼š
- ä½¿ç”¨WebVTTå‰ç«¯å­—å¹•ï¼ˆåªåœ¨æ’­æ”¾å™¨æ˜¾ç¤ºï¼‰
- ä¸‹è½½åè§†é¢‘æ— å­—å¹•

**ç›®æ ‡**ï¼šä¸‹è½½çš„è§†é¢‘å¿…é¡»åŒ…å«çƒ§å½•çš„å­—å¹•

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **ä¼˜å…ˆæ–¹æ¡ˆ**ï¼šåç«¯FFmpegçƒ§å½•ï¼ˆéœ€è¦åç«¯å¼€å‘ï¼‰
- **å¤‡é€‰æ–¹æ¡ˆ**ï¼šå‰ç«¯FFmpeg.wasmçƒ§å½•ï¼ˆæ€§èƒ½å·®ï¼Œä½†å¯ç«‹å³ä½¿ç”¨ï¼‰

**è¯¦ç»†æ–¹æ¡ˆ**ï¼šè§ `docs/å­—å¹•çƒ§å½•å®ç°æ–¹æ¡ˆ.md`

---

## ğŸ¨ å†…å®¹å«æ¥ä¼˜åŒ–æ–¹æ¡ˆ

### é—®é¢˜1ï¼šå•å›¾ç‰‡+æ–‡æ¡ˆå¦‚ä½•å«æ¥

**ç°çŠ¶åˆ†æ**ï¼š
- å½“å‰æœ‰å›¾ç‰‡ã€æ–‡æ¡ˆã€éŸ³é¢‘ä¸‰ç§ç´ æ
- å›¾ç‰‡+æ–‡æ¡ˆå¯ä»¥ç”Ÿæˆï¼š
  1. æµ·æŠ¥ï¼ˆå·²æœ‰ï¼Œä½†è®¾è®¡å¤ªéš¾çœ‹ï¼‰
  2. å¯¹è”ï¼ˆå·²æœ‰ï¼Œä½†è®¾è®¡å¤ªéš¾çœ‹ï¼‰
  3. è§†é¢‘ï¼ˆéœ€è¦éŸ³é¢‘ï¼‰

**æ ¸å¿ƒé—®é¢˜**ï¼šæµ·æŠ¥å’Œå¯¹è”çš„è§†è§‰è®¾è®¡ä¸å¤Ÿå¸å¼•äºº

---

### è§£å†³æ–¹æ¡ˆAï¼šæµ·æŠ¥ç³»ç»Ÿé‡è®¾è®¡

#### å½“å‰æµ·æŠ¥ç³»ç»Ÿåˆ†æ

**æ–‡ä»¶ä½ç½®**ï¼š
- `src/configs/festival/posterTemplates.ts` - æ¨¡æ¿é…ç½®ï¼ˆå¡«ç©ºå¼æ–¹æ¡ˆï¼‰
- `src/utils/posterCanvas.ts` - Canvasç»˜åˆ¶å·¥å…·
- `src/components/PosterGeneratorExample.tsx` - æµ·æŠ¥ç”Ÿæˆå™¨
- `src/hooks/usePosterGenerator.ts` - æµ·æŠ¥ç”ŸæˆHook

**å¡«ç©ºå¼æ–¹æ¡ˆä¼˜åŠ¿**ï¼š
- æ¨¡æ¿é©±åŠ¨ï¼Œæ˜“äºæ‰©å±•
- å¯é…ç½®æ€§å¼ºï¼ˆå­—ä½“ã€é¢œè‰²ã€ä½ç½®ï¼‰
- æ”¯æŒå¤šç§å¸ƒå±€

**å½“å‰é—®é¢˜**ï¼š
1. æ¨¡æ¿è®¾è®¡ä¸å¤Ÿç°ä»£åŒ–
2. ç¼ºå°‘è§†è§‰å†²å‡»åŠ›
3. å­—ä½“æ’ç‰ˆä¸å¤Ÿç²¾è‡´

#### æµ·æŠ¥é‡è®¾è®¡å»ºè®®

**è®¾è®¡æ–¹å‘1ï¼šæç®€ç°ä»£é£**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         â”‚
â”‚                         â”‚
â”‚    [ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡]      â”‚
â”‚    (åœ†è§’ï¼Œè½»å¾®é˜´å½±)       â”‚
â”‚                         â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é©¬å¹´å¤§å‰ï¼Œæ­å–œå‘è´¢  â”‚  â”‚
â”‚  â”‚  æ„¿æ‚¨èº«ä½“å¥åº·ï¼Œ      â”‚  â”‚
â”‚  â”‚  ä¸‡äº‹å¦‚æ„ï¼          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚
â”‚  ç¦è¢‹AIÂ·é©¬å¹´å¤§å‰        â”‚
â”‚  [äºŒç»´ç ] 2025.01.XX    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
- å¤§é¢ç§¯ç•™ç™½
- å›¾ç‰‡å æ®ä¸»è§†è§‰
- æ–‡æ¡ˆç®€æ´æ¸…æ™°
- åº•éƒ¨å°å­—å“ç‰Œæ ‡è¯†
```

**è®¾è®¡æ–¹å‘2ï¼šå›½æ½®é£**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â•”â•â•â•â•—      â•”â•â•â•â•—      â”‚
â”‚  â•‘ç¦è¢‹â•‘      â•‘å¤§å‰â•‘      â”‚
â”‚  â•šâ•â•â•â•      â•šâ•â•â•â•      â”‚
â”‚                         â”‚
â”‚    [ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡]      â”‚
â”‚    (å¤é£è¾¹æ¡†è£…é¥°)        â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æ–°å¹´å¿«ä¹          â”‚    â”‚
â”‚  â”‚ ä¸‡äº‹å¦‚æ„          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚   ğŸ® ç¦è¢‹AIÂ·2025 ğŸ®     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
- ä¼ ç»Ÿå…ƒç´ ç°ä»£åŒ–
- çº¢è‰²é‡‘è‰²é…è‰²
- è£…é¥°æ€§å…ƒç´ ï¼ˆç¯ç¬¼ã€äº‘çº¹ï¼‰
- å›½æ½®å­—ä½“
```

**è®¾è®¡æ–¹å‘3ï¼šå¡ç‰‡é£ï¼ˆæ¨èï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“    â”‚
â”‚ â”ƒ                 â”ƒ    â”‚
â”‚ â”ƒ  [ç”¨æˆ·å›¾ç‰‡]      â”ƒ    â”‚
â”‚ â”ƒ  (å±…ä¸­,åœ†è§’)     â”ƒ    â”‚
â”‚ â”ƒ                 â”ƒ    â”‚
â”‚ â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›    â”‚
â”‚                         â”‚
â”‚  ğŸ“ æ‹œå¹´ç¥ç¦            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  é©¬å¹´å¤§å‰ï¼Œæ­å–œå‘è´¢ï¼    â”‚
â”‚  æ„¿æ‚¨èº«ä½“å¥åº·ï¼Œ          â”‚
â”‚  ä¸‡äº‹å¦‚æ„ï¼              â”‚
â”‚                         â”‚
â”‚  âŠ¹ ç¦è¢‹AIÂ·é©¬å¹´å¤§å‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
- å¡ç‰‡å¼å¸ƒå±€
- å±‚æ¬¡åˆ†æ˜
- å›¾ç‰‡+æ–‡å­—åˆ†åŒºæ¸…æ™°
- ç°ä»£ç®€çº¦
```

#### å…·ä½“å®æ–½æ–¹æ¡ˆï¼ˆæµ·æŠ¥ï¼‰

**Step 1ï¼šåˆ›å»ºæ–°æ¨¡æ¿é…ç½®**

```typescript
// src/configs/festival/posterTemplatesV2.ts

export const MODERN_POSTER_TEMPLATES = [
  {
    id: 'modern_card_1',
    name: 'ç°ä»£å¡ç‰‡-ç®€çº¦',
    canvas: { width: 750, height: 1334 },

    // èƒŒæ™¯
    background: {
      type: 'gradient',
      colors: ['#FFF5F0', '#FFFFFF']
    },

    // å›¾ç‰‡åŒºåŸŸ
    imageRegion: {
      x: 75,
      y: 120,
      width: 600,
      height: 600,
      borderRadius: 24,
      shadow: {
        offsetX: 0,
        offsetY: 4,
        blur: 20,
        color: 'rgba(0,0,0,0.1)'
      }
    },

    // æ–‡æ¡ˆåŒºåŸŸ
    textRegion: {
      x: 75,
      y: 780,
      width: 600,
      height: 400,
      fontSize: 32,
      lineHeight: 48,
      color: '#333333',
      textAlign: 'center'
    },

    // å“ç‰Œæ ‡è¯†
    brandMark: {
      text: 'ç¦è¢‹AIÂ·é©¬å¹´å¤§å‰',
      x: 375,
      y: 1250,
      fontSize: 20,
      color: '#999999'
    }
  },

  {
    id: 'guochao_1',
    name: 'å›½æ½®é£-çº¢é‡‘',
    canvas: { width: 750, height: 1334 },

    background: {
      type: 'image',
      src: '/assets/posters/bg_guochao.jpg'
    },

    decorations: [
      {
        type: 'image',
        src: '/assets/posters/lantern_left.png',
        x: 50,
        y: 50,
        width: 100,
        height: 100
      },
      {
        type: 'image',
        src: '/assets/posters/lantern_right.png',
        x: 600,
        y: 50,
        width: 100,
        height: 100
      }
    ],

    imageRegion: {
      x: 125,
      y: 200,
      width: 500,
      height: 500,
      borderRadius: 16,
      borderStyle: 'traditional', // ä¼ ç»Ÿè¾¹æ¡†
      borderColor: '#D4AF37' // é‡‘è‰²
    },

    textRegion: {
      x: 75,
      y: 800,
      width: 600,
      height: 350,
      fontSize: 36,
      fontFamily: 'ç«™é…·åº†ç§‘é»„æ²¹ä½“', // å›½æ½®å­—ä½“
      color: '#B8001C', // ä¸­å›½çº¢
      textAlign: 'center'
    }
  }
];
```

**Step 2ï¼šä¼˜åŒ–ç»˜åˆ¶å·¥å…·**

```typescript
// src/utils/posterCanvasV2.ts

export async function generateModernPoster(
  template: ModernPosterTemplate,
  userImage: string,
  text: string
): Promise<string> {
  const canvas = createCanvas(template.canvas.width, template.canvas.height);
  const ctx = canvas.getContext('2d')!;

  // 1. ç»˜åˆ¶èƒŒæ™¯
  await drawBackground(ctx, template.background);

  // 2. ç»˜åˆ¶è£…é¥°å…ƒç´ 
  if (template.decorations) {
    for (const deco of template.decorations) {
      await drawDecoration(ctx, deco);
    }
  }

  // 3. ç»˜åˆ¶ç”¨æˆ·å›¾ç‰‡
  await drawUserImage(ctx, userImage, template.imageRegion);

  // 4. ç»˜åˆ¶æ–‡æ¡ˆ
  drawText(ctx, text, template.textRegion);

  // 5. ç»˜åˆ¶å“ç‰Œæ ‡è¯†
  if (template.brandMark) {
    drawBrandMark(ctx, template.brandMark);
  }

  return canvas.toDataURL('image/png', 0.95);
}

// å›¾ç‰‡ç»˜åˆ¶ï¼ˆæ”¯æŒåœ†è§’ã€é˜´å½±ã€è¾¹æ¡†ï¼‰
async function drawUserImage(
  ctx: CanvasRenderingContext2D,
  imageSrc: string,
  region: ImageRegion
) {
  const img = await loadImage(imageSrc);

  // ä¿å­˜çŠ¶æ€
  ctx.save();

  // ç»˜åˆ¶é˜´å½±
  if (region.shadow) {
    ctx.shadowOffsetX = region.shadow.offsetX;
    ctx.shadowOffsetY = region.shadow.offsetY;
    ctx.shadowBlur = region.shadow.blur;
    ctx.shadowColor = region.shadow.color;
  }

  // ç»˜åˆ¶åœ†è§’çŸ©å½¢è·¯å¾„
  drawRoundedRect(ctx, region.x, region.y, region.width, region.height, region.borderRadius || 0);
  ctx.clip();

  // ç»˜åˆ¶å›¾ç‰‡ï¼ˆå±…ä¸­è£å‰ªï¼‰
  const scale = Math.max(region.width / img.width, region.height / img.height);
  const scaledWidth = img.width * scale;
  const scaledHeight = img.height * scale;
  const offsetX = (region.width - scaledWidth) / 2;
  const offsetY = (region.height - scaledHeight) / 2;

  ctx.drawImage(
    img,
    region.x + offsetX,
    region.y + offsetY,
    scaledWidth,
    scaledHeight
  );

  // æ¢å¤çŠ¶æ€
  ctx.restore();

  // ç»˜åˆ¶è¾¹æ¡†
  if (region.borderStyle) {
    drawBorder(ctx, region);
  }
}

// æ–‡å­—ç»˜åˆ¶ï¼ˆæ”¯æŒå¤šè¡Œã€è‡ªåŠ¨æ¢è¡Œï¼‰
function drawText(
  ctx: CanvasRenderingContext2D,
  text: string,
  region: TextRegion
) {
  ctx.font = `${region.fontSize}px ${region.fontFamily || 'PingFang SC'}`;
  ctx.fillStyle = region.color;
  ctx.textAlign = region.textAlign;

  // è‡ªåŠ¨æ¢è¡Œ
  const lines = wrapText(ctx, text, region.width);
  const lineHeight = region.lineHeight || region.fontSize * 1.5;

  lines.forEach((line, index) => {
    const y = region.y + index * lineHeight;
    const x = region.textAlign === 'center' ? region.x + region.width / 2 : region.x;
    ctx.fillText(line, x, y);
  });
}
```

**Step 3ï¼šUIé›†æˆ**

```typescript
// åœ¨ResultPageæˆ–VideoPageæ·»åŠ "ç”Ÿæˆæµ·æŠ¥"æŒ‰é’®

<FestivalButton
  variant="ghost"
  onClick={() => {
    navigate('/festival/poster-generator', {
      state: {
        image: currentImage,
        text: currentText
      }
    });
  }}
>
  ç”Ÿæˆæµ·æŠ¥
</FestivalButton>
```

---

### è§£å†³æ–¹æ¡ˆBï¼šå¯¹è”ç³»ç»Ÿé‡è®¾è®¡

#### å½“å‰å¯¹è”ç³»ç»Ÿåˆ†æ

**æ–‡ä»¶ä½ç½®**ï¼š
- `src/utils/coupletCanvas.ts` - å¯¹è”ç»˜åˆ¶å·¥å…·
- `src/components/CoupletEditor.tsx` - å¯¹è”ç¼–è¾‘å™¨

**å½“å‰é—®é¢˜**ï¼š
1. è§†è§‰è®¾è®¡è¿‡äºä¼ ç»Ÿï¼ˆçº¢çº¸é‡‘å­—è¿‡æ—¶ï¼‰
2. ç¼ºå°‘ç°ä»£æ„Ÿ
3. å¸ƒå±€å•è°ƒ

#### å¯¹è”é‡è®¾è®¡å»ºè®®

**è®¾è®¡æ–¹å‘1ï¼šç°ä»£å¯¹è”ï¼ˆæ¨èï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚     â”‚  â”‚     â”‚  â”‚     â”‚
â”‚ æ¨ª  â”‚  â”‚ æ¨ª  â”‚  â”‚ æ¨ª  â”‚
â”‚ æ‰¹  â”‚  â”‚ æ‰¹  â”‚  â”‚ æ‰¹  â”‚
â”‚     â”‚  â”‚     â”‚  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”
â”‚ ä¸Š  â”‚          â”‚ ä¸‹  â”‚
â”‚ è”  â”‚          â”‚ è”  â”‚
â”‚ å†…  â”‚          â”‚ å†…  â”‚
â”‚ å®¹  â”‚          â”‚ å®¹  â”‚
â”‚ ç«–  â”‚          â”‚ ç«–  â”‚
â”‚ æ’  â”‚          â”‚ æ’  â”‚
â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
- ç™½è‰²æˆ–ç±³è‰²èƒŒæ™¯
- é»‘è‰²æˆ–æ·±ç°æ–‡å­—
- ç®€çº¦è¾¹æ¡†
- ç°ä»£å­—ä½“ï¼ˆæ€æºé»‘ä½“/å®‹ä½“ï¼‰
- å¯é€‰æ¸å˜èƒŒæ™¯
```

**è®¾è®¡æ–¹å‘2ï¼šå›½æ½®å¯¹è”**

```
â•”â•â•â•â•â•â•—  â•”â•â•â•â•â•â•—  â•”â•â•â•â•â•â•—
â•‘ é¾™  â•‘  â•‘ é©¬  â•‘  â•‘ å‡¤  â•‘
â•‘ è…¾  â•‘  â•‘ å¹´  â•‘  â•‘ èˆ  â•‘
â•‘ å››  â•‘  â•‘ å¤§  â•‘  â•‘ ä¹  â•‘
â•‘ æµ·  â•‘  â•‘ å‰  â•‘  â•‘ å¤©  â•‘
â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•

â”â”â”â”â”â”â”“          â”â”â”â”â”â”â”“
â”ƒ     â”ƒ          â”ƒ     â”ƒ
â”ƒ æ–°  â”ƒ          â”ƒ æ—§  â”ƒ
â”ƒ å²  â”ƒ          â”ƒ å¹´  â”ƒ
â”ƒ æ·»  â”ƒ          â”ƒè¾  â”ƒ
â”ƒ å–œ  â”ƒ          â”ƒ å»  â”ƒ
â”ƒ æ°”  â”ƒ          â”ƒ çŸ£  â”ƒ
â”ƒ     â”ƒ          â”ƒ     â”ƒ
â”—â”â”â”â”â”â”›          â”—â”â”â”â”â”â”›

ç‰¹ç‚¹ï¼š
- æ¸å˜èƒŒæ™¯ï¼ˆçº¢åˆ°æ©™ï¼‰
- é‡‘è‰²æ–‡å­—æˆ–ç™½è‰²æ–‡å­—
- äº‘çº¹è£…é¥°
- å›½æ½®å­—ä½“ï¼ˆç«™é…·ç³»åˆ—ï¼‰
```

**è®¾è®¡æ–¹å‘3ï¼šæ‰å¹³åŒ–å¯¹è”**

```
â–“â–“â–“â–“â–“â–“â–“   â–“â–“â–“â–“â–“â–“â–“   â–“â–“â–“â–“â–“â–“â–“
â–“       â–“   â–“       â–“   â–“       â–“
â–“ æ¨ªæ‰¹  â–“   â–“ æ¨ªæ‰¹  â–“   â–“ æ¨ªæ‰¹  â–“
â–“       â–“   â–“       â–“   â–“       â–“
â–“â–“â–“â–“â–“â–“â–“   â–“â–“â–“â–“â–“â–“â–“   â–“â–“â–“â–“â–“â–“â–“

â–“â–“â–“â–“â–“â–“â–“               â–“â–“â–“â–“â–“â–“â–“
â–“ ä¸Šè” â–“               â–“ ä¸‹è” â–“
â–“ å†…å®¹ â–“               â–“ å†…å®¹ â–“
â–“ ç«–æ’ â–“               â–“ ç«–æ’ â–“
â–“â–“â–“â–“â–“â–“â–“               â–“â–“â–“â–“â–“â–“â–“

ç‰¹ç‚¹ï¼š
- çº¯è‰²å¡ç‰‡
- é˜´å½±æ•ˆæœ
- æ‰å¹³åŒ–è®¾è®¡
- æ— è¡¬çº¿å­—ä½“
```

#### å…·ä½“å®æ–½æ–¹æ¡ˆï¼ˆå¯¹è”ï¼‰

**Step 1ï¼šåˆ›å»ºç°ä»£å¯¹è”æ¨¡æ¿**

```typescript
// src/configs/festival/coupletTemplatesV2.ts

export interface CoupletTemplateV2 {
  id: string;
  name: string;
  preview: string;

  // ç”»å¸ƒå°ºå¯¸
  canvas: {
    width: number;
    height: number;
  };

  // èƒŒæ™¯
  background: {
    type: 'solid' | 'gradient' | 'image';
    colors?: string[];
    imageSrc?: string;
  };

  // ä¸Šè”
  upperCouplet: {
    x: number;
    y: number;
    width: number;
    height: number;
    fontSize: number;
    fontFamily: string;
    color: string;
    backgroundColor?: string;
    borderRadius?: number;
    shadow?: ShadowConfig;
  };

  // ä¸‹è”
  lowerCouplet: {
    x: number;
    y: number;
    width: number;
    height: number;
    fontSize: number;
    fontFamily: string;
    color: string;
    backgroundColor?: string;
    borderRadius?: number;
    shadow?: ShadowConfig;
  };

  // æ¨ªæ‰¹
  horizontalScroll: {
    x: number;
    y: number;
    width: number;
    height: number;
    fontSize: number;
    fontFamily: string;
    color: string;
    backgroundColor?: string;
    borderRadius?: number;
  };
}

export const COUPLET_TEMPLATES_V2: CoupletTemplateV2[] = [
  {
    id: 'modern_simple',
    name: 'ç°ä»£ç®€çº¦',
    preview: '/assets/couplet-previews/modern_simple.jpg',

    canvas: { width: 1200, height: 1600 },

    background: {
      type: 'gradient',
      colors: ['#FFF5F0', '#FFE8DC']
    },

    horizontalScroll: {
      x: 400,
      y: 100,
      width: 400,
      height: 150,
      fontSize: 56,
      fontFamily: 'æ€æºå®‹ä½“',
      color: '#333333',
      backgroundColor: '#FFFFFF',
      borderRadius: 16
    },

    upperCouplet: {
      x: 150,
      y: 350,
      width: 180,
      height: 1100,
      fontSize: 48,
      fontFamily: 'æ€æºå®‹ä½“',
      color: '#333333',
      backgroundColor: '#FFFFFF',
      borderRadius: 12,
      shadow: {
        offsetX: 0,
        offsetY: 2,
        blur: 8,
        color: 'rgba(0,0,0,0.1)'
      }
    },

    lowerCouplet: {
      x: 870,
      y: 350,
      width: 180,
      height: 1100,
      fontSize: 48,
      fontFamily: 'æ€æºå®‹ä½“',
      color: '#333333',
      backgroundColor: '#FFFFFF',
      borderRadius: 12,
      shadow: {
        offsetX: 0,
        offsetY: 2,
        blur: 8,
        color: 'rgba(0,0,0,0.1)'
      }
    }
  },

  {
    id: 'guochao_red_gold',
    name: 'å›½æ½®-çº¢é‡‘',
    preview: '/assets/couplet-previews/guochao.jpg',

    canvas: { width: 1200, height: 1600 },

    background: {
      type: 'gradient',
      colors: ['#B8001C', '#8B0000']
    },

    horizontalScroll: {
      x: 400,
      y: 100,
      width: 400,
      height: 150,
      fontSize: 52,
      fontFamily: 'ç«™é…·åº†ç§‘é»„æ²¹ä½“',
      color: '#FFD700',
      backgroundColor: 'rgba(0,0,0,0.3)',
      borderRadius: 12
    },

    upperCouplet: {
      x: 150,
      y: 350,
      width: 180,
      height: 1100,
      fontSize: 44,
      fontFamily: 'ç«™é…·åº†ç§‘é»„æ²¹ä½“',
      color: '#FFD700',
      backgroundColor: 'rgba(0,0,0,0.3)',
      borderRadius: 8
    },

    lowerCouplet: {
      x: 870,
      y: 350,
      width: 180,
      height: 1100,
      fontSize: 44,
      fontFamily: 'ç«™é…·åº†ç§‘é»„æ²¹ä½“',
      color: '#FFD700',
      backgroundColor: 'rgba(0,0,0,0.3)',
      borderRadius: 8
    }
  }
];
```

**Step 2ï¼šä¼˜åŒ–ç»˜åˆ¶å·¥å…·**

```typescript
// src/utils/coupletCanvasV2.ts

export async function generateModernCouplet(
  template: CoupletTemplateV2,
  coupletData: CoupletData
): Promise<string> {
  const canvas = createCanvas(template.canvas.width, template.canvas.height);
  const ctx = canvas.getContext('2d')!;

  // 1. ç»˜åˆ¶èƒŒæ™¯
  drawBackground(ctx, template);

  // 2. ç»˜åˆ¶æ¨ªæ‰¹
  drawHorizontalScroll(ctx, coupletData.horizontalScroll, template.horizontalScroll);

  // 3. ç»˜åˆ¶ä¸Šè”
  drawVerticalText(ctx, coupletData.upperLine, template.upperCouplet);

  // 4. ç»˜åˆ¶ä¸‹è”
  drawVerticalText(ctx, coupletData.lowerLine, template.lowerCouplet);

  return canvas.toDataURL('image/png', 0.95);
}

// ç»˜åˆ¶ç«–æ’æ–‡å­—
function drawVerticalText(
  ctx: CanvasRenderingContext2D,
  text: string,
  config: CoupletRegionConfig
) {
  // ç»˜åˆ¶èƒŒæ™¯å¡ç‰‡
  if (config.backgroundColor) {
    ctx.save();

    // é˜´å½±
    if (config.shadow) {
      ctx.shadowOffsetX = config.shadow.offsetX;
      ctx.shadowOffsetY = config.shadow.offsetY;
      ctx.shadowBlur = config.shadow.blur;
      ctx.shadowColor = config.shadow.color;
    }

    // åœ†è§’çŸ©å½¢
    drawRoundedRect(
      ctx,
      config.x,
      config.y,
      config.width,
      config.height,
      config.borderRadius || 0
    );

    ctx.fillStyle = config.backgroundColor;
    ctx.fill();

    ctx.restore();
  }

  // ç»˜åˆ¶æ–‡å­—
  ctx.font = `${config.fontSize}px ${config.fontFamily}`;
  ctx.fillStyle = config.color;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';

  const chars = text.split('');
  const charSpacing = (config.height - 60) / chars.length;
  const startY = config.y + 30;
  const centerX = config.x + config.width / 2;

  chars.forEach((char, index) => {
    const y = startY + index * charSpacing + charSpacing / 2;
    ctx.fillText(char, centerX, y);
  });
}
```

**Step 3ï¼šæ·»åŠ æ¨¡æ¿é¢„è§ˆå’Œé€‰æ‹©**

```typescript
// src/components/CoupletTemplateSelector.tsx

export const CoupletTemplateSelector: React.FC<Props> = ({ onSelect }) => {
  return (
    <div className="template-selector">
      <h3>é€‰æ‹©å¯¹è”é£æ ¼</h3>
      <div className="template-grid">
        {COUPLET_TEMPLATES_V2.map(template => (
          <div
            key={template.id}
            className="template-card"
            onClick={() => onSelect(template)}
          >
            <img src={template.preview} alt={template.name} />
            <div className="template-name">{template.name}</div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

---

## ğŸ“‹ å®æ–½ä¼˜å…ˆçº§

### P0 - ç«‹å³ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰
- [x] ä¿å­˜åŠŸèƒ½ä¿®å¤
- [x] ç»“æœé¡µé‡è®¾è®¡
- [x] å¿«é€Ÿæ–‡æ¡ˆæ¨¡æ¿
- [x] ç”ŸæˆåŠ¨ç”»

### P1 - æœ¬å‘¨å®Œæˆ
- [ ] å­—å¹•çƒ§å½•ï¼ˆåç«¯FFmpeg APIï¼‰
- [ ] æµ·æŠ¥ç³»ç»Ÿé‡è®¾è®¡ï¼ˆ3ä¸ªç°ä»£æ¨¡æ¿ï¼‰
- [ ] å¯¹è”ç³»ç»Ÿé‡è®¾è®¡ï¼ˆ3ä¸ªç°ä»£æ¨¡æ¿ï¼‰

### P2 - ä¸‹å‘¨å®Œæˆ
- [ ] æµ·æŠ¥æ¨¡æ¿æ‰©å±•ï¼ˆ10+æ¨¡æ¿ï¼‰
- [ ] å¯¹è”æ¨¡æ¿æ‰©å±•ï¼ˆ10+æ¨¡æ¿ï¼‰
- [ ] ç´ æç»„åˆæ™ºèƒ½æ¨èä¼˜åŒ–
- [ ] å•å›¾ç‰‡+æ–‡æ¡ˆæ›´å¤šç©æ³•

---

## ğŸ’¡ è®¾è®¡å»ºè®®æ€»ç»“

### æµ·æŠ¥è®¾è®¡åŸåˆ™
1. **ç°ä»£ç®€çº¦** > ä¼ ç»Ÿå¤æ‚
2. **å¤§é¢ç§¯ç•™ç™½** > å…ƒç´ å †ç Œ
3. **å›¾ç‰‡ä¸ºä¸»** > æ–‡å­—ä¸ºä¸»
4. **å±‚æ¬¡åˆ†æ˜** > å¹³é¢å•è°ƒ
5. **å“ç‰Œæ ‡è¯†å°è€Œç²¾** > å¤§è€Œæ˜¾çœ¼

### å¯¹è”è®¾è®¡åŸåˆ™
1. **æ‰“ç ´ä¼ ç»Ÿçº¢é‡‘é…è‰²**ï¼šå°è¯•ç™½è‰²ã€ç±³è‰²ã€æ¸å˜
2. **ç°ä»£å­—ä½“**ï¼šæ€æºå®‹ä½“ã€æ€æºé»‘ä½“ã€ç«™é…·ç³»åˆ—
3. **å¡ç‰‡åŒ–è®¾è®¡**ï¼šåœ†è§’ã€é˜´å½±ã€å±‚æ¬¡
4. **è£…é¥°å…‹åˆ¶**ï¼šå°‘å³æ˜¯å¤š
5. **å¯è¯»æ€§ä¼˜å…ˆ**ï¼šå­—å·ã€é—´è·ã€å¯¹æ¯”åº¦

### å†…å®¹å«æ¥ç­–ç•¥
1. **å›¾ç‰‡+æ–‡æ¡ˆ** â†’ æµ·æŠ¥ï¼ˆè§†è§‰å†²å‡»ï¼‰
2. **å›¾ç‰‡+æ–‡æ¡ˆ+éŸ³é¢‘** â†’ è§†é¢‘ï¼ˆåŠ¨æ€è¡¨è¾¾ï¼‰
3. **çº¯æ–‡æ¡ˆ** â†’ å¯¹è”ï¼ˆæ–‡åŒ–ä¼ æ‰¿ï¼‰
4. **å›¾ç‰‡** â†’ æ–°å¹´å¤´åƒï¼ˆä¸ªæ€§åŒ–ï¼‰
5. **æ™ºèƒ½æ¨è**ï¼šæ ¹æ®ç”¨æˆ·å·²æœ‰ç´ æï¼Œæ¨èè¡¥å……åŠŸèƒ½

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### æœ¬å‘¨ä»»åŠ¡ï¼ˆ2026-02-05 - 2026-02-11ï¼‰

**Day 1-2ï¼šè®¾è®¡èµ„äº§å‡†å¤‡**
- [ ] è®¾è®¡3ä¸ªç°ä»£æµ·æŠ¥æ¨¡æ¿ï¼ˆFigma/Sketchï¼‰
- [ ] è®¾è®¡3ä¸ªç°ä»£å¯¹è”æ¨¡æ¿
- [ ] å‡†å¤‡èƒŒæ™¯ç´ æï¼ˆæ¸å˜ã€çº¹ç†ï¼‰
- [ ] å‡†å¤‡è£…é¥°å…ƒç´ ï¼ˆå›¾æ ‡ã€è¾¹æ¡†ï¼‰

**Day 3-4ï¼šä»£ç å®ç°**
- [ ] å®ç°posterTemplatesV2.tsé…ç½®
- [ ] å®ç°coupletTemplatesV2.tsé…ç½®
- [ ] ä¼˜åŒ–posterCanvasV2.tsç»˜åˆ¶å·¥å…·
- [ ] ä¼˜åŒ–coupletCanvasV2.tsç»˜åˆ¶å·¥å…·

**Day 5-6ï¼šé›†æˆæµ‹è¯•**
- [ ] åˆ›å»ºæµ·æŠ¥ç”Ÿæˆå™¨é¡µé¢
- [ ] åˆ›å»ºå¯¹è”ç”Ÿæˆå™¨é¡µé¢
- [ ] é›†æˆåˆ°ContinueCreationPanel
- [ ] å®Œæ•´æµç¨‹æµ‹è¯•

**Day 7ï¼šä¼˜åŒ–æ‰“ç£¨**
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆCanvasç»˜åˆ¶åŠ é€Ÿï¼‰
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] Bugä¿®å¤

---

## ğŸ” æŠ€æœ¯å€ºåŠ¡

### éœ€è¦åç«¯æ”¯æŒçš„åŠŸèƒ½
1. **å­—å¹•çƒ§å½•API**ï¼ˆP0ï¼‰
   - æ¥æ”¶ï¼šè§†é¢‘URL + æ–‡æ¡ˆ + æ—¶é•¿
   - è¿”å›ï¼šå¸¦å­—å¹•çš„è§†é¢‘URL
   - æŠ€æœ¯æ ˆï¼šPython + FFmpeg

2. **æµ·æŠ¥/å¯¹è”é«˜æ¸…æ¸²æŸ“**ï¼ˆP2ï¼Œå¯é€‰ï¼‰
   - æ¥æ”¶ï¼šæ¨¡æ¿ID + å›¾ç‰‡URL + æ–‡æ¡ˆ
   - è¿”å›ï¼šé«˜æ¸…æµ·æŠ¥URLï¼ˆ4Kåˆ†è¾¨ç‡ï¼‰
   - æŠ€æœ¯æ ˆï¼šNode.js + Sharp / Python + Pillow

### å‰ç«¯ä¼˜åŒ–
1. **Canvasæ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨OffscreenCanvas
   - Web Workeråå°æ¸²æŸ“
   - æ¸è¿›å¼åŠ è½½

2. **å­—ä½“åŠ è½½ä¼˜åŒ–**
   - å­—ä½“å­é›†åŒ–
   - æ‡’åŠ è½½éå…³é”®å­—ä½“
   - ä½¿ç”¨font-display: swap

3. **å›¾ç‰‡å¤„ç†ä¼˜åŒ–**
   - å‹ç¼©ä¸Šä¼ å‰çš„å›¾ç‰‡
   - WebPæ ¼å¼æ”¯æŒ
   - æ¸è¿›å¼JPEG

---

## ğŸ“Š æ•ˆæœé¢„æœŸ

### æµ·æŠ¥/å¯¹è”é‡è®¾è®¡å
- ç”¨æˆ·æ»¡æ„åº¦ï¼šé¢„è®¡æå‡50%+
- åˆ†äº«ç‡ï¼šé¢„è®¡æå‡30%+
- äºŒæ¬¡åˆ›ä½œç‡ï¼šé¢„è®¡æå‡40%+

### å­—å¹•çƒ§å½•å®ç°å
- è§†é¢‘ä¸‹è½½æ»¡æ„åº¦ï¼š100%ï¼ˆå½“å‰çº¦30%ï¼‰
- ç”¨æˆ·æŠ•è¯‰ï¼šå‡å°‘90%+
- è§†é¢‘åˆ†äº«ç‡ï¼šæå‡50%+

---

**å¤‡æ³¨**ï¼š
- æ‰€æœ‰è®¾è®¡æ–¹æ¡ˆéƒ½åŸºäºå¡«ç©ºå¼æ¶æ„ï¼Œæ˜“äºæ‰©å±•
- æ¨¡æ¿æ•°é‡å¯æ ¹æ®ç”¨æˆ·åé¦ˆæŒç»­å¢åŠ 
- ä¼˜å…ˆå®ç°3ä¸ªç²¾å“æ¨¡æ¿ï¼Œå†æ¨ªå‘æ‰©å±•

**éœ€è¦çš„èµ„æº**ï¼š
1. è®¾è®¡å¸ˆï¼šæµ·æŠ¥/å¯¹è”æ¨¡æ¿è®¾è®¡
2. åç«¯å¼€å‘ï¼šå­—å¹•çƒ§å½•API
3. å‰ç«¯å¼€å‘ï¼šCanvasç»˜åˆ¶ä¼˜åŒ–ï¼ˆæˆ‘æ¥åšï¼‰
4. æµ‹è¯•ï¼šå®Œæ•´æµç¨‹æµ‹è¯•

---

**åˆ›å»ºæ—¶é—´**: 2026-02-05 21:30
**ä½œè€…**: Claude Code
**ç‰ˆæœ¬**: v1.0
