# 福袋AI - 开发规范

**创建日期**: 2026-02-01
**重要性**: 极高 - 必须严格遵守

---

## 目录

1. [CSS修改规范](#css修改规范)
2. [Grid/Flex布局规范](#gridflex布局规范)
3. [移动端H5开发原则](#移动端h5开发原则)
4. [问题诊断流程](#问题诊断流程)
5. [常见错误案例](#常见错误案例)

---

## CSS修改规范

### ⚠️ 血的教训
**已因违反此规范浪费大几十美金！**

### 核心原则
**永远不要盲目修改CSS，必须先全面检查所有覆盖关系。**

### 正确的CSS修改流程

#### 1. 修改前检查（必须）

```bash
# 搜索所有相关的CSS选择器
grep -r "\.class-name" src/styles/

# 或使用Grep工具
Grep pattern="\.class-name" path="src/styles/" output_mode="content"
```

**检查内容**:
- 是否有多个文件定义了同一个选择器
- 是否有更具体的选择器会覆盖（如 `.parent .child` 优先级高于 `.child`）
- 是否有 `!important` 标记
- CSS加载顺序：后加载的会覆盖先加载的

#### 2. 一次性修改所有相关位置

**错误做法 ❌**:
```
1. 修改 file1.css
2. 用户说没效果
3. 修改 file2.css
4. 用户说还是没效果
5. 修改 file3.css
6. ...（浪费大量时间和金钱）
```

**正确做法 ✅**:
```
1. Grep搜索所有相关选择器
2. 列出所有需要修改的位置
3. 一次性全部修改
4. 验证结果
```

#### 3. 第一次修改后没效果的处理

**如果用户反馈修改没生效，立即执行**:

1. **不要等用户催促**，立即主动检查
2. 用Grep搜索所有CSS文件中的相关选择器
3. 检查是否有覆盖关系
4. 找出所有覆盖的地方，一次性全部修改

**时间要求**: 1分钟内开始检查，不要拖延

### CSS优先级规则

#### 优先级从高到低:
1. `!important`
2. 内联样式 `style="..."`
3. ID选择器 `#id`
4. 类选择器 `.class`、属性选择器 `[attr]`、伪类 `:hover`
5. 元素选择器 `div`、伪元素 `::before`

#### 相同优先级时:
- **更具体的选择器优先**: `.parent .child` > `.child`
- **后加载的CSS优先**: 后面的覆盖前面的

#### 常见覆盖陷阱:

```css
/* ❌ 会被覆盖 */
.feature-name {
  color: black;
}

/* ✅ 优先级更高 */
.feature-info-v2 .feature-name {
  color: white;
}

/* ✅✅ 优先级最高 */
.feature-card-v2 .feature-info-v2 .feature-name {
  color: red;
}
```

### CSS文件加载顺序

**本项目的典型顺序**:
1. `festival-design-system.css` - 设计系统变量
2. `festival.css` - 基础样式
3. `festival-xxx-glass.css` - Glassmorphism风格覆盖

**注意**: 后加载的会覆盖先加载的！

### 修改前检查清单

- [ ] 用Grep搜索所有相关选择器
- [ ] 列出所有需要修改的文件和位置
- [ ] 检查CSS加载顺序
- [ ] 检查选择器优先级
- [ ] 一次性修改所有相关位置
- [ ] 如果第一次没生效，立即检查覆盖（不等用户催促）

---

## Grid/Flex布局规范

### CSS Grid布局的黄金法则

**Grid布局属性只对Grid Container的直接子元素生效**

- `grid-column` / `grid-row` / `grid-area` 必须设置在直接子元素上
- 如果在直接子元素外包裹了wrapper，必须把grid属性移到wrapper上
- Grid Container看不到孙元素，只能控制子元素的位置

### 常见错误模式

```html
<!-- ❌ 错误：grid-column设置在孙元素上 -->
<div class="grid-container">
  <div class="wrapper">
    <div class="grid-item" style="grid-column: span 2">内容</div>
  </div>
</div>

<!-- ✅ 正确：grid-column设置在直接子元素上 -->
<div class="grid-container">
  <div class="wrapper" style="grid-column: span 2">
    <div class="grid-item">内容</div>
  </div>
</div>
```

### 添加wrapper时的注意事项

**在添加wrapper div时**:
1. 检查原有的grid/flex属性
2. 将这些属性移到wrapper上
3. 使用浏览器DevTools验证布局

---

## 移动端H5开发原则

### 核心理念

**移动端H5 ≠ 桌面端缩小版**
必须移动端优先设计，而非桌面端适配。

### 开发原则

1. **移动端优先** - 先写移动端CSS，再适配桌面
2. **空间宝贵** - 每个元素都要考虑是否必需
3. **容器原则** - 容器尺寸必须 > 最大子元素
4. **测试优先** - 每次改动立即在真实手机测试
5. **避免!important** - 除非确认必须覆盖

### 常见问题排查

#### 问题1: 移动端看不到更新
**不是缓存问题！** 首先检查：
1. CSS文件的 `@media (max-width: 480px)` 部分是否正确
2. 元素尺寸是否计算正确（容器 > 内容）
3. 是否有inline styles覆盖CSS
4. 媒体查询是否被其他规则覆盖

#### 问题2: 布局错乱
检查：
1. Grid/Flex容器和子元素关系
2. 是否添加了wrapper破坏了布局
3. 媒体查询是否生效
4. 元素overflow和position设置

---

## 问题诊断流程

### 标准诊断流程

```
1. 精准理解问题（截图、标注、描述）
   ↓
2. 复现问题（真实设备测试）
   ↓
3. 检查代码逻辑（CSS、JS、API）
   ↓
4. 验证假设（开发者工具）
   ↓
5. 小范围修改
   ↓
6. 立即测试验证
```

### 布局问题诊断

**优先使用浏览器DevTools**:
1. 检查实际渲染的DOM结构
2. 检查计算后的CSS样式
3. 使用Grid/Flex Inspector
4. 不要盲目调整数值

### 禁止行为

- ❌ 未理解问题就改代码
- ❌ 桌面端测试通过就认为完成
- ❌ 把问题归咎于缓存等外部因素
- ❌ 大范围修改后才测试
- ❌ 用桌面思维做移动端产品

---

## 常见错误案例

### 案例1: 分类页文字颜色问题（2026-02-01）

**问题描述**:
- 需求：把分类页文字改成黑色
- 实际：反复修改5次以上，每次都说"已改成黑色"，但用户看到的还是白色
- 原因：只修改了 `festival-category-glass.css`，没有检查 `festival.css` 中的覆盖

**覆盖关系**:
```css
/* festival-category-glass.css - 先加载 */
.feature-name {
  color: #000000; /* ❌ 被覆盖了 */
}

/* festival.css - 后加载，优先级更高 */
.feature-info-v2 .feature-name {
  color: white; /* ✅ 实际生效的 */
}
```

**正确做法**:
```bash
# 第一步：搜索所有相关选择器
grep -r "\.feature-name" src/styles/

# 结果：
# - festival-category-glass.css:140: .feature-name
# - festival.css:3234: .feature-name
# - festival.css:3572: .feature-info-v2 .feature-name

# 第二步：一次性修改所有3处
```

**损失**: 时间约30分钟，成本大几十美金

---

### 案例2: HomePageGlass布局崩溃（2026-02-01）

**问题描述**:
将卡片标题移到外部后，grid布局从"一大2小加一个横"变成了2x2均匀布局。

**根本原因**:
添加wrapper div后，grid的直接子元素从 `.glass-card` 变成了 wrapper，但 `grid-column: span 2` 仍设置在 `.glass-card` 上。

**原始代码（正常）**:
```tsx
<div className="category-grid">
  <div className="glass-card card-large">  {/* ✓ 直接子元素 */}
    内容
  </div>
</div>
```

**修改后（崩溃）**:
```tsx
<div className="category-grid">
  <div>  {/* ← wrapper成为直接子元素 */}
    <div className="glass-card card-large">  {/* ✗ 孙元素，grid-column失效 */}
      内容
    </div>
  </div>
</div>
```

**正确修复**:
```tsx
<div
  style={{
    gridColumn: (isFirst || isLast) ? 'span 2' : 'auto'  // ← 移到wrapper上
  }}
>
  <div className="glass-card">内容</div>
</div>
```

**教训**:
- 添加wrapper时必须同步检查CSS
- 使用DevTools立即验证布局
- Grid属性只对直接子元素生效

---

### 案例3: 移动端步骤指示器问题（2026-01-30）

**问题描述**:
移动端步骤指示器占据屏幕1/3高度，用户需下滑才能看到生成按钮。

**错误诊断**:
AI首先怀疑是缓存问题，浪费1小时清除缓存、修改端口等。

**实际问题**:
步骤指示器在移动端占用空间太多，应该完全隐藏。

**正确解法**:
```css
@media (max-width: 480px) {
  .step-indicator {
    display: none !important;  /* 移动端隐藏 */
  }
}
```

**教训**:
- 移动端问题不要首先怀疑缓存
- 检查代码逻辑而非外部因素
- 移动端空间宝贵，不必要的元素直接隐藏

---

## 其他UI问题排查

### 图片遮挡问题

**检查项**:
- `opacity` 属性
- `background` 的透明度
- 渐变遮罩层 `linear-gradient`
- `backdrop-filter: blur()` 效果
- 覆盖在图片上的元素

**解决方法**:
1. 搜索所有可能影响透明度的属性
2. 一次性全部检查并修改
3. 不要一个个试

### 文字看不清问题

**常见原因**:
1. 颜色对比度不够（白字白底、浅灰字浅色背景）
2. CSS被覆盖（最常见）
3. 文字有透明度
4. 背景模糊影响文字渲染
5. 字体渲染问题（antialiasing）

**检查顺序**:
1. Grep搜索所有相关选择器
2. 检查颜色值（是否是白色/透明）
3. 检查背景（是否有blur）
4. 一次性修改所有问题

---

## 总结

### 一句话总结
> 改CSS前先全面检查，一次性改完所有地方，不要试错，第一次没效果立即检查覆盖。

### 记住
- 用户的时间和金钱很宝贵
- 不要让用户反复催促
- 主动、快速、一次性解决问题
- CSS覆盖问题1秒钟就能用Grep检查出来

---

**此规范必须严格遵守，违反将导致严重的时间和金钱损失。**
