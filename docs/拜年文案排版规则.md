# 拜年文案排版规则

## 📏 **字数限制标准**

### **核心原则**
所有文案生成功能必须遵守字数限制，确保在海报排版中完整显示。

### **具体限制**

| 功能 | 最小字数 | 最大字数 | 说明 |
|------|---------|---------|------|
| 拜年文案 | 80字 | 120字 | 适配海报description区域（8行×15字/行） |
| AI春联 | 14字 | 18字 | 上联7-9字，下联7-9字 |
| 横批 | 4字 | 4字 | 固定4字 |
| 运势判词 | 8字 | 12字 | 短句吉祥话 |

---

## 🎨 **海报模板：拜年文案专用**

### **BLESSING_TEXT_POSTER 配置**

**模板ID**: `blessing-text`

**画布尺寸**: 750px × 1200px

**布局结构**:
```
┌─────────────────────────────────┐
│                                 │
│        [主图片区域]              │ ← 650×650px
│        用户上传照片              │
│                                 │
├─────────────────────────────────┤
│                                 │
│    [文案区域 - 白色卡片]        │
│                                 │
│    您好，过去一年您的指导        │
│    让我受益匪浅。马年将至，      │ ← 24px字体
│    祝您球场上一杆进洞，事业      │    行高1.8
│    上更上层楼。新的一年，我      │    最多8行
│    会继续努力，不辜负您的信      │    630px宽
│    任与期待。                    │
│                                 │
│                    [福袋AI 水印] │
└─────────────────────────────────┘
```

**文案区域详细参数**:
- **X坐标**: 60px
- **Y坐标**: 730px
- **宽度**: 630px
- **高度**: 380px
- **字体大小**: 24px
- **行高**: 1.8
- **最大行数**: 8行
- **最大字数**: 120字
- **对齐方式**: 左对齐
- **字体**: "Noto Sans SC", "PingFang SC", "Microsoft YaHei"
- **颜色**: #37474F（深灰色）

---

## ✍️ **Prompt 约束要求**

### **DeepSeek 生成配置**

```typescript
{
  model: 'deepseek-chat',
  promptKey: 'blessing',
  maxTokens: 200,
  temperature: 0.8
}
```

### **Prompt 核心约束**

1. **字数严格**: 80-120字（适配海报排版）
2. **禁止超标**: 超过120字会显示不全
3. **风格匹配**: 根据对象（领导/长辈/朋友等）调整语气
4. **必含元素**: 必须包含"马年"或"2025"
5. **避免陈词**: 不用"万事如意"、"心想事成"等烂大街的词

---

## 🔗 **联动规则**

### **拜年文案 + 图片联动**

**保存为MaterialAtom**:
```typescript
{
  type: 'text',
  data: { text: '生成的文案...' },
  connectors: {
    roles: ['posterText'],
    canCombineWith: ['image', 'audio']
  }
}
```

**联动流程**:
1. 用户生成拜年文案 → 自动保存为素材
2. 用户上传图片 → 选择组合
3. 系统使用 `BLESSING_TEXT_POSTER` 模板生成海报
4. 文案显示在白色卡片区域（自动换行）

### **拜年文案 + 语音联动**

**流程**:
1. 生成文案 → 保存为素材
2. 点击"转语音"按钮
3. 调用 Fish Audio TTS
4. 生成语音贺卡（带文案+音频）

---

## 📊 **排版计算规则**

### **字数与行数对应**

**假设**:
- 字体大小: 24px
- 行高: 1.8 (43.2px)
- 区域宽度: 630px
- 每行最多字数: ~26字（630 / 24 ≈ 26）

**实际**:
- 考虑标点符号和换行，每行约 15-18 字
- 8行 × 15字/行 = 120字上限

### **Canvas 渲染规则**

```typescript
// 自动换行函数
function wrapText(
  ctx: CanvasRenderingContext2D,
  text: string,
  x: number,
  y: number,
  maxWidth: number,
  lineHeight: number
) {
  // 按字符分割
  // 逐行测量宽度
  // 超过maxWidth时换行
}
```

---

## ⚠️ **注意事项**

1. **永远不要超过120字**: 超过会被截断或显示不全
2. **换行由系统自动处理**: 不要手动加\n
3. **标点符号占位**: 中文标点占一个字符位
4. **英文单词不拆分**: 如果有英文，可能影响排版
5. **emoji慎用**: emoji占宽度不固定，可能打乱排版

---

## 🎯 **测试检查清单**

开发完成后，必须测试以下场景：

- [ ] 80字文案显示完整
- [ ] 120字文案显示完整（满行）
- [ ] 100字文案排版美观（居中分布）
- [ ] 包含标点符号的文案正常换行
- [ ] 包含数字的文案正常显示
- [ ] 长辈/领导风格的正式文案
- [ ] 朋友/爱人风格的轻松文案
- [ ] 文案保存为素材成功
- [ ] 文案+图片联动生成海报成功
- [ ] 文案+语音联动生成语音卡成功

---

**最后更新**: 2026-02-02
**状态**: ✅ 已定稿
