# æµè½¬é—®é¢˜å…¨é¢æ’æŸ¥æŠ¥å‘Š

**æ’æŸ¥æ—¶é—´**: 2026-02-08
**æ’æŸ¥èŒƒå›´**: æ‰€æœ‰Festivalé¡µé¢æ•°æ®æµè½¬
**çŠ¶æ€**: âœ… æ’æŸ¥å®Œæˆï¼Œå¾…ä¿®å¤

---

## ä¸€ã€é—®é¢˜æ€»ç»“

### å‘ç°çš„é—®é¢˜

| æ–‡ä»¶ | è¡Œå· | é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ |
|------|------|------|---------|------|
| **TextPage.tsx** | 315-323 | ä½¿ç”¨`prefillText`è€Œé`text` | ğŸ”´ **ä¸¥é‡** | éœ€ä¿®å¤ |
| **DigitalHumanPage.tsx** | 739, 773 | ä½¿ç”¨`prefillText`è€Œé`text` | ğŸŸ¡ **ä½** | å·²åºŸå¼ƒï¼Œæ— éœ€ä¿®å¤ |

### æ­£å¸¸çš„æ–‡ä»¶ï¼ˆæ— éœ€ä¿®å¤ï¼‰

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **ResultPage.tsx** | âœ… **æ­£ç¡®** | ä½¿ç”¨createNavigationState |
| **VoicePageNew.tsx** | âœ… **æ­£ç¡®** | ä½¿ç”¨createNavigationStateå’ŒgetNavigationState |
| **VideoPage.tsx** | âœ… **æ­£ç¡®** | ä½¿ç”¨getNavigationState |
| **VideoCategoryPage.tsx** | âœ… **æ­£ç¡®** | ä½¿ç”¨getNavigationState |
| **MaterialLibraryPage.tsx** | âœ… **æ­£ç¡®** | ä½¿ç”¨createNavigationState |
| **ContinueCreationPanel.tsx** | âœ… **æ­£ç¡®** | ä½¿ç”¨createNavigationState |
| **SmartReplyPage.tsx** | âœ… **æ­£å¸¸** | æ— æµè½¬é€»è¾‘ |
| **FortuneCardPage.tsx** | âœ… **æ­£å¸¸** | æ— æµè½¬é€»è¾‘ |

---

## äºŒã€è¯¦ç»†åˆ†æ

### é—®é¢˜1: TextPage.tsx (Line 315-323)

**å½“å‰ä»£ç **:
```typescript
const handleToVoice = () => {
  // é€šè¿‡stateä¼ é€’æ–‡æ¡ˆï¼Œè·³è½¬åˆ°è¯­éŸ³é¡µ
  navigate('/festival/voice', {
    state: {
      prefillText: generatedText,  // âŒ é”™è¯¯å­—æ®µ
      sourceFeature: featureId      // âŒ é”™è¯¯å­—æ®µ
    }
  });
};
```

**é—®é¢˜**:
1. ä½¿ç”¨`prefillText`è€Œéæ ‡å‡†å­—æ®µ`text`
2. ä½¿ç”¨`sourceFeature`è€Œéæ ‡å‡†å­—æ®µ`sourceFeatureId`
3. æ²¡æœ‰ä½¿ç”¨`createNavigationState`åˆ›å»ºæ ‡å‡†æ•°æ®ç»“æ„

**å½±å“**:
- VoicePageNew.tsxæœŸå¾…`text`å­—æ®µï¼Œå¯¼è‡´æ•°æ®æ¥æ”¶å¤±è´¥
- ç”¨æˆ·ç‚¹å‡»"è½¬ä¸ºè¯­éŸ³"åï¼Œæ–‡æ¡ˆä¸ä¼šä¼ é€’åˆ°è¯­éŸ³é¡µ

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
const handleToVoice = () => {
  // âœ… ä½¿ç”¨æ ‡å‡†NavigationState
  const navState = createNavigationState({
    text: generatedText,
    textSource: 'ai',  // AIç”Ÿæˆçš„æ–‡æ¡ˆ
    sourceFeatureId: featureId,
    sourcePagePath: location.pathname
  });

  navigate('/festival/voice', { state: navState });
};
```

---

### é—®é¢˜2: DigitalHumanPage.tsx (Line 739, 773)

**çŠ¶æ€**: ğŸŸ¡ **å·²åºŸå¼ƒï¼Œæ— éœ€ä¿®å¤**

**åŸå› **:
- App.tsx Line 35æ³¨é‡Šæ˜¾ç¤º: `// âœ… å·²åˆå¹¶åˆ°VideoPage`
- DigitalHumanPageå·²ä¸å†ä½¿ç”¨
- è·¯ç”±å·²é‡å®šå‘: `<Route path="digital-human" element={<Navigate to="/festival/video" replace />} />`

**æ— éœ€ä¿®å¤**.

---

## ä¸‰ã€å­—æ•°æ§åˆ¶åŠŸèƒ½ä¿ç•™

æ ¹æ®`textLengthRules.ts`ï¼Œä»¥ä¸‹åŠŸèƒ½éœ€è¦ä¿ç•™ï¼š

### VoicePageNew.tsxå·²å®ç°çš„å­—æ•°æ§åˆ¶

**Location**: Line 62-77

```typescript
// âœ… æµè½¬è§„åˆ™æ£€æŸ¥1: textType éªŒè¯
if (navState.textType) {
  if (navState.textType === 'fortune' || navState.textType === 'couplet') {
    message.warning('è¿åŠ¿å’Œæ˜¥è”æ–‡æ¡ˆé€šå¸¸è¾ƒé•¿ï¼Œå»ºè®®æ‰‹åŠ¨è°ƒæ•´ä¸º80å­—ä»¥å†…ï¼ˆçº¦15ç§’ï¼‰');
    console.warn('[VoicePageNew] é•¿æ–‡æ¡ˆç±»å‹ï¼š', navState.textType);
  }
}

// âœ… æµè½¬è§„åˆ™æ£€æŸ¥2: é•¿æ–‡æ¡ˆè‡ªåŠ¨æˆªæ–­
let incomingText = navState.text || navState.originalCaption || '';
if (incomingText.length > 80) {
  incomingText = incomingText.substring(0, 80);
  message.warning('æ–‡æ¡ˆè¿‡é•¿ï¼Œå·²è‡ªåŠ¨æˆªå–å‰80å­—ï¼ˆå»ºè®®æ§åˆ¶åœ¨80å­—ä»¥å†…ï¼Œçº¦15ç§’ï¼‰');
  console.log('[VoicePageNew] æ–‡æ¡ˆæˆªæ–­ï¼šåŸé•¿åº¦', navState.text?.length, 'â†’ 80å­—');
}
```

**ä¿®å¤æ—¶å¿…é¡»ä¿ç•™æ­¤åŠŸèƒ½** - è¿™æ˜¯å¥½åŠŸèƒ½ï¼Œä¸èƒ½ç ´åï¼

---

## å››ã€å®Œæ•´æµè½¬è·¯å¾„éªŒè¯

### è·¯å¾„1: æ–‡æ¡ˆ â†’ è¯­éŸ³

```
TextPage (æ–‡æ¡ˆç”Ÿæˆ)
    â†“ handleToVoice()
    â†“ ä½¿ç”¨ createNavigationState({ text, textSource, sourceFeatureId })
VoicePageNew (è¯­éŸ³ç”Ÿæˆ)
    â†“ getNavigationState(location.state)
    â†“ è¯»å– text å­—æ®µ âœ…
    â†“ è‡ªåŠ¨æˆªæ–­é•¿æ–‡æ¡ˆï¼ˆ80å­—ï¼‰âœ…
```

**çŠ¶æ€**: ğŸ”´ éœ€ä¿®å¤ - TextPageæœªä½¿ç”¨æ ‡å‡†å­—æ®µ

---

### è·¯å¾„2: ç»“æœé¡µ â†’ è¯­éŸ³

```
ResultPage (ç»“æœå±•ç¤º)
    â†“ handleToVoice() Line 182
    â†“ createNavigationState({ text, originalCaption, textSource, ... }) âœ…
VoicePageNew
    â†“ getNavigationState(location.state) âœ…
```

**çŠ¶æ€**: âœ… æ­£å¸¸

---

### è·¯å¾„3: ç»“æœé¡µ â†’ è§†é¢‘é€‰æ‹©

```
ResultPage
    â†“ handleToVideo() Line 196
    â†“ createNavigationState({ image, text, ... }) âœ…
VideoCategoryPage
    â†“ getNavigationState(location.state) âœ…
```

**çŠ¶æ€**: âœ… æ­£å¸¸

---

### è·¯å¾„4: è¯­éŸ³é¡µ â†’ è§†é¢‘é€‰æ‹©

```
VoicePageNew
    â†“ handleToVideo() Line 357
    â†“ createNavigationState({ audio, text, ... }) âœ…
VideoCategoryPage
    â†“ getNavigationState(location.state) âœ…
```

**çŠ¶æ€**: âœ… æ­£å¸¸

---

### è·¯å¾„5: ç´ æåº“ â†’ è§†é¢‘é€‰æ‹©

```
MaterialLibraryPage
    â†“ Line 115
    â†“ createNavigationState({ image, text, audio, ... }) âœ…
VideoCategoryPage
    â†“ getNavigationState(location.state) âœ…
```

**çŠ¶æ€**: âœ… æ­£å¸¸

---

## äº”ã€ä¿®å¤æ¸…å•

### éœ€è¦ä¿®å¤çš„æ–‡ä»¶

- [x] **TextPage.tsx** - ä¿®å¤handleToVoiceå‡½æ•°
  - å¯¼å…¥createNavigationState
  - ä¿®æ”¹Line 315-323ä½¿ç”¨æ ‡å‡†å­—æ®µ

### æ— éœ€ä¿®å¤çš„æ–‡ä»¶

- DigitalHumanPage.tsx - å·²åºŸå¼ƒ
- å…¶ä»–æ–‡ä»¶ - å·²æ­£ç¡®ä½¿ç”¨æ ‡å‡†API

---

## å…­ã€ä¿®å¤åéªŒè¯æ¸…å•

- [ ] TextPageç”Ÿæˆæ–‡æ¡ˆ
- [ ] ç‚¹å‡»"è½¬ä¸ºè¯­éŸ³"
- [ ] VoicePageNewæ­£ç¡®æ¥æ”¶æ–‡æ¡ˆ
- [ ] é•¿æ–‡æ¡ˆè‡ªåŠ¨æˆªæ–­ï¼ˆ80å­—ï¼‰
- [ ] å¯ä»¥æ­£å¸¸ç”Ÿæˆè¯­éŸ³

---

**æ’æŸ¥å®Œæˆæ—¶é—´**: 2026-02-08
**éœ€ä¿®å¤æ–‡ä»¶æ•°**: 1ä¸ª
**é¢„è®¡ä¿®å¤æ—¶é—´**: 5åˆ†é’Ÿ
